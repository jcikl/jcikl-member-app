# 日常账户交易用途管理功能

## 功能概述
在财务类别管理页面新增了"日常账户用途"标签页，用于统一管理日常账户的交易用途（二次分类）选项。

## 主要特性

### 1. 统一管理界面
- **位置**: 系统设置 > 财务类别管理 > 🏦 日常账户用途
- **功能**: 集中管理所有日常账户交易的二次分类选项

### 2. 数据结构
```typescript
interface TransactionPurpose {
  id: string;                     // 文档ID（自动生成）
  value: string;                  // 用途代码（格式: TXGA-0001，自动生成）
  label: string;                  // 显示名称
  category: 'general-accounts';   // 类别（固定为日常账户）
  description?: string;           // 描述
  sortOrder: number;              // 排序
  status: 'active' | 'inactive';  // 状态
  createdAt: string;
  updatedAt: string;
  createdBy: string;
  updatedBy?: string;
}
```

### 2.1 自动编号规则
- **格式**: `TXGA-XXXX`
  - `TXGA` = Transaction General Accounts（日常账户交易）
  - `XXXX` = 4位数字序号（0001, 0002, 0003...）
- **示例**: TXGA-0001, TXGA-0002, TXGA-0003
- **生成逻辑**: 自动查找当前最大序号并加1

### 3. 核心功能

#### 3.1 添加交易用途
- 点击"添加交易用途"按钮
- **系统自动生成用途代码**（如 TXGA-0001）
- 填写表单：
  - **用途代码**: 自动生成，格式为 TXGA-0001（新建时不可修改，编辑时可修改）
  - **显示名称**: 在下拉列表中显示的名称（例如: "办公用品采购"、"差旅费用"）
  - **描述**: 用途说明和使用场景
  - **排序**: 控制显示顺序（数字越小越靠前）
  - **状态**: 启用/禁用

#### 3.2 编辑交易用途
- 点击列表中的编辑按钮
- 修改用途信息
- **支持修改用途代码**（但会影响所有使用此用途的交易）
- ⚠️ **警告**: 修改代码会影响所有使用此用途的交易

#### 3.3 删除交易用途
- 点击列表中的删除按钮
- 确认删除操作
- **注意**: 删除后，使用此用途的交易需要重新分类

#### 3.4 启用/禁用状态
- 禁用的用途不会显示在创建/编辑交易的下拉列表中
- 已使用的用途可以禁用但不建议删除

### 4. 与现有功能的集成

#### 4.1 日常账户页面
- 二次分类筛选下拉框自动加载活跃的交易用途
- 显示用途的`label`字段，存储用途的`value`字段

#### 4.2 交易管理页面
- 编辑交易时，二次分类字段可以选择预定义的用途
- 支持手动输入自定义用途

#### 4.3 批量分类功能
- 批量设置交易的二次分类时，可选择预定义的用途

## 文件修改

### 新增文件
1. **src/modules/system/services/transactionPurposeService.ts**
   - 交易用途管理服务层
   - 提供CRUD操作
   - 提供获取活跃用途选项的方法

### 修改文件
1. **src/modules/system/pages/FinancialCategoryManagementPage/index.tsx**
   - 新增"日常账户用途"标签页
   - 新增交易用途的CRUD操作
   - 新增专门的表格列定义和表单字段

## 使用示例

### 示例1: 添加办公用品用途
```
用途代码: TXGA-0001 (自动生成)
显示名称: 办公用品采购
描述: 用于日常办公用品的采购支出
排序: 10
状态: 启用
```

### 示例2: 添加差旅费用途
```
用途代码: TXGA-0002 (自动生成)
显示名称: 差旅费用
描述: 用于会员出差产生的交通、住宿等费用
排序: 20
状态: 启用
```

### 示例3: 添加水电费用途
```
用途代码: TXGA-0003 (自动生成)
显示名称: 水电费缴纳
描述: 用于办公场所的水电费支付
排序: 30
状态: 启用
```

## 数据存储

### Firestore集合
- **集合名称**: `fin_txPurpose`
- **文档ID**: 自动生成
- **索引**: 无需额外索引（查询简单）

### 数据示例
```json
{
  "id": "auto-generated-id",
  "value": "TXGA-0001",
  "label": "办公用品采购",
  "category": "general-accounts",
  "description": "用于日常办公用品的采购支出",
  "sortOrder": 10,
  "status": "active",
  "createdAt": "2024-01-15T10:30:00.000Z",
  "updatedAt": "2024-01-15T10:30:00.000Z",
  "createdBy": "user-id-123"
}
```

## API方法

### 服务层方法
```typescript
// 生成下一个交易用途代码
generateNextPurposeCode(): Promise<string>

// 获取所有交易用途
getAllTransactionPurposes(): Promise<TransactionPurpose[]>

// 获取交易用途（带状态过滤）
getTransactionPurposes(status?: 'active' | 'inactive'): Promise<TransactionPurpose[]>

// 获取单个交易用途
getTransactionPurpose(id: string): Promise<TransactionPurpose | null>

// 创建交易用途
createTransactionPurpose(purposeData, userId): Promise<string>

// 更新交易用途
updateTransactionPurpose(id, updates, userId): Promise<void>

// 删除交易用途
deleteTransactionPurpose(id, userId): Promise<void>

// 获取活跃的交易用途选项（用于下拉框）
getActiveTransactionPurposes(): Promise<Array<{ label: string; value: string }>>
```

## 权限控制
- 需要系统管理员权限才能访问财务类别管理页面
- 所有操作都会记录操作人ID和时间

## 验证规则
- `value`字段: 必填，格式必须为 TXGA-XXXX（自动生成），不能重复
- `label`字段: 必填，最大100字符
- `description`字段: 可选，最大500字符
- `sortOrder`字段: 数字类型
- `status`字段: 必须是'active'或'inactive'

## 最佳实践

### 1. 命名规范
- **用途代码**: 系统自动生成（TXGA-0001, TXGA-0002...），无需手动命名
- **显示名称**: 使用清晰、具体的名称（例如: "办公用品采购"、"差旅费用"、"水电费缴纳"）

### 2. 排序策略
- 常用用途设置较小的排序值（如10、20、30）
- 不常用用途设置较大的排序值（如100、200）
- 预留排序间隔，方便后续插入新用途

### 3. 状态管理
- 不再使用的用途应设为"禁用"而非删除
- 只有确认没有任何交易使用的用途才可删除

### 4. 描述填写
- 应明确说明用途的适用场景
- 可以包含使用示例
- 有助于团队成员正确分类交易

## 未来扩展

### 可能的功能增强
1. 用途使用统计（显示每个用途被使用的次数）
2. 批量导入/导出交易用途
3. 用途分组管理（例如: 行政类、业务类、营销类）
4. 用途使用趋势分析
5. 自动建议功能（基于交易描述推荐用途）

## 注意事项

### ⚠️ 重要提醒
1. **自动编号**: 系统自动生成TXGA-XXXX格式的用途代码，确保唯一性
2. **代码修改**: 编辑时可修改代码，但会影响所有使用该用途的交易，请谨慎操作
3. **删除谨慎**: 删除用途前应确认没有交易正在使用
4. **显示名称**: 建议团队内部统一显示名称的命名规范
5. **定期清理**: 定期审查和清理不再使用的用途

## 故障排查

### 问题1: 用途不显示在下拉框中
**解决方案**: 检查用途状态是否为"启用"

### 问题2: 无法删除用途
**解决方案**: 可能有交易正在使用该用途，先更改这些交易的分类

### 问题3: 用途代码重复
**解决方案**: 系统会自动检测并提示，请使用不同的代码

## 测试建议

### 功能测试
1. ✅ 创建新的交易用途
2. ✅ 编辑现有交易用途
3. ✅ 删除未使用的交易用途
4. ✅ 启用/禁用交易用途
5. ✅ 验证用途在日常账户页面的下拉框中显示
6. ✅ 验证用途排序是否正确

### 边界测试
1. ⚠️ 尝试创建重复的用途代码
2. ⚠️ 尝试输入超长的用途代码/名称
3. ⚠️ 尝试删除正在使用的用途

## 总结
日常账户交易用途管理功能提供了统一、规范的方式来管理交易的二次分类选项，有助于提高财务数据的一致性和准确性。

