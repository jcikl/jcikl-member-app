# 🔍 累计余额跨页错误诊断指南

## 📋 请按以下步骤操作

### Step 1: 打开浏览器控制台
1. 按 `F12` 打开开发者工具
2. 切换到 `Console` 标签
3. 清空控制台（点击 🚫 图标）

---

### Step 2: 查看第15页（最早的交易）
1. 在交易管理页面，翻到**第15页**（最后一页）
2. 查看控制台输出，找到以下信息：

```
📌 Step 1: 确定当前页时间范围（只看父交易）
   当前页总交易数: ? 笔
   当前页父交易数: ? 笔      ← 记录这个数字
   当前页子交易数: ? 笔
   最新父交易: ?
   最早父交易: ?              ← 记录日期和描述
   
📌 Step 2: 获取起始余额
   起始余额: RM ?             ← 记录这个金额

📌 父交易余额检查:
   最新父交易 (UI第一条): ? - 余额 RM ?
   最早父交易 (UI最后条): ? - 余额 RM ?  ← 记录这个余额
```

**请复制以上信息**

---

### Step 3: 查看第14页
1. 翻到**第14页**
2. 查看控制台输出，找到：

```
📌 Step 1: 确定当前页时间范围（只看父交易）
   最新父交易: ?              ← 记录日期
   最早父交易: ?              ← 记录日期
   
📌 Step 2: 获取起始余额
   起始余额: RM ?             ← 记录这个金额

📌 父交易余额检查:
   最新父交易 (UI第一条): ? - 余额 RM ?  ← 记录这个余额
   最早父交易 (UI最后条): ? - 余额 RM ?
```

**请复制以上信息**

---

### Step 4: 对比两页的余额

#### 检查点 A：起始余额
```
第15页（最早）起始余额: RM _______
第14页起始余额: RM _______

问题检查：
  第14页起始余额 应该 > 第15页起始余额
  因为第14页的交易更晚，之前累计的交易更多
```

#### 检查点 B：页面连接
```
第15页最新父交易（UI第一条）余额: RM _______
第14页最早父交易（UI最后条）余额: RM _______

问题检查：
  这两个余额应该接近或相同
  因为它们在时间上相邻
```

#### 检查点 C：余额方向
```
第15页:
  最早父交易（UI最后）: RM _______
  最新父交易（UI第一）: RM _______
  
  最新 应该 > 最早（如果期间是净收入）
  或
  最新 应该 < 最早（如果期间是净支出）
```

---

### Step 5: 识别问题类型

#### 问题类型 1：起始余额错误
```
症状：
  第14页起始余额 < 第15页起始余额  ❌

原因：
  getBalanceBeforeDate() 计算错误
  可能包含了子交易或日期过滤有问题

诊断：
  查看控制台中 [getBalanceBeforeDate] 的输出
  检查"过滤后交易数"是否正确
```

#### 问题类型 2：页面不连续
```
症状：
  第15页最新 ≠ 第14页最早  ❌

原因：
  分页逻辑有问题
  或者子交易影响了分页边界

诊断：
  检查两页的"最早父交易日期"
  应该有明确的时间分界
```

#### 问题类型 3：累计方向错误
```
症状：
  UI最新交易（第一条）余额 < UI最早交易（最后条）❌

原因：
  累计方向仍然是从上到下
  而不是从下到上

诊断：
  查看 console.table 输出
  检查"累加后"是否递增
```

#### 问题类型 4：子交易影响余额
```
症状：
  余额跳跃式增长
  有子交易的地方余额异常

原因：
  子交易被计入累计余额

诊断：
  查看 console.table 输出
  检查是否有子交易参与累加
```

---

## 📊 正确的控制台输出示例

### 第15页（最后一页）
```
📌 Step 1: 确定当前页时间范围（只看父交易）
   当前页总交易数: 5 笔
   当前页父交易数: 5 笔
   当前页子交易数: 0 笔
   最新父交易: 2024-07-18 - Lee Ying Shen
   最早父交易: 2024-06-30 - NG WEI LONG
   
📌 Step 2: 获取起始余额
   起始余额: RM 14457.44  ← 初始余额（01-Jul之前）

📌 父交易余额检查:
   最新父交易 (UI第一条): 2024-07-18 - 余额 RM 37372.54
   最早父交易 (UI最后条): 2024-06-30 - 余额 RM 12799.44
   ✅ 最新余额 > 最早余额
```

### 第14页
```
📌 Step 1: 确定当前页时间范围（只看父交易）
   当前页总交易数: 20 笔
   当前页父交易数: 18 笔
   当前页子交易数: 2 笔
   最新父交易: 2024-09-30 - ...
   最早父交易: 2024-07-25 - ...
   
📌 Step 2: 获取起始余额
   起始余额: RM 12799.44  ← 应该 ≈ 第15页最早父交易余额

📌 父交易余额检查:
   最新父交易 (UI第一条): 2024-09-30 - 余额 RM 23518.95
   最早父交易 (UI最后条): 2024-07-25 - 余额 RM ???
```

---

## 🎯 请提供以下信息

### 信息 1：第15页控制台输出
```
复制完整的：
📌 Step 1: ...
📌 Step 2: ...
📌 父交易余额检查: ...
📌 Step 5: ...
```

### 信息 2：第14页控制台输出
```
复制完整的：
📌 Step 1: ...
📌 Step 2: ...
📌 父交易余额检查: ...
📌 Step 5: ...
```

### 信息 3：第13页控制台输出（可选）
```
如果问题仍然不清楚，也提供第13页的输出
```

---

## 💡 快速检查清单

### 检查 1：子交易过滤
- [ ] 查看"当前页父交易数"和"当前页子交易数"
- [ ] 确认子交易没有参与余额计算

### 检查 2：起始余额连续性
- [ ] 第14页起始余额 ≈ 第15页最早父交易余额
- [ ] 第13页起始余额 ≈ 第14页最早父交易余额

### 检查 3：累计方向
- [ ] UI 第一条（最新）余额最大
- [ ] UI 最后条（最早）余额最小
- [ ] 从下往上余额递增（如果净收入为正）

---

## 🔧 临时诊断工具

如果控制台信息太多，难以找到关键信息，请：

1. **清空控制台**：点击 🚫 图标
2. **刷新页面**：F5
3. **直接跳到第15页**：避免其他页面的日志干扰
4. **复制完整输出**：右键 → Save as...

---

**请提供第14和第15页的完整控制台输出，我将帮你定位问题！** 🔍

