# è´¢åŠ¡æ ‡ç­¾é¡µæœç´¢è¡Œä¸ºå·®å¼‚åˆ†æ

## ğŸ” é—®é¢˜æè¿°

ç”¨æˆ·å‘ç°æ´»åŠ¨è´¢åŠ¡æ ‡ç­¾é¡µçš„æœç´¢æ åœ¨è¾“å…¥åç«‹å³æœç´¢ï¼Œè€Œä¼šå‘˜è´¹ç”¨æ ‡ç­¾é¡µå’Œæ—¥å¸¸è´¦æˆ·æ ‡ç­¾é¡µåˆ™ä¸ä¼šç«‹å³æœç´¢ã€‚

## ğŸ“Š ä¸‰ä¸ªæ ‡ç­¾é¡µçš„æœç´¢å®ç°å¯¹æ¯”

### **æ´»åŠ¨è´¢åŠ¡æ ‡ç­¾é¡µ**

#### **ä»£ç å®ç°**
```typescript
// src/modules/finance/pages/EventFinancialPage/index.tsx

// æœç´¢æ¡†
<Input
  placeholder="æœç´¢æ´»åŠ¨åç§°ã€è´Ÿè´£ç†äº‹ã€é‡‘é¢ã€çŠ¶æ€..."
  value={searchText}
  onChange={(e) => setSearchText(e.target.value)}  // âœ… åªæ›´æ–°çŠ¶æ€
  // âŒ æ²¡æœ‰ onPressEnter
/>

// useEffectä¾èµ–
useEffect(() => {
  loadEventFinancials();
  loadFinanceEvents();
  loadActiveMembers();
}, [filter, selectedYear, selectedBoardMember, selectedEventStatus, selectedEventType, searchText]);
//                                                                              ^^^^^^^^^^
//                                                                              âœ… searchTextåœ¨ä¾èµ–ä¸­
```

**è¡Œä¸º**: 
- âœ… `onChange` æ›´æ–° `searchText` çŠ¶æ€
- âœ… `searchText` åœ¨ `useEffect` ä¾èµ–æ•°ç»„ä¸­
- âœ… çŠ¶æ€å˜åŒ– â†’ è§¦å‘ `useEffect` â†’ é‡æ–°åŠ è½½æ•°æ®
- **ç»“æœ**: **è¾“å…¥æ—¶ç«‹å³æœç´¢** âš¡

---

### **ä¼šå‘˜è´¹ç”¨æ ‡ç­¾é¡µ**

#### **ä»£ç å®ç°**
```typescript
// src/modules/finance/pages/MemberFeeManagementPage/index.tsx

// æœç´¢æ¡†
<Input
  placeholder="æœç´¢ä¼šå‘˜å§“åæˆ–ID..."
  value={searchText}
  onChange={(e) => setSearchText(e.target.value)}  // âœ… åªæ›´æ–°çŠ¶æ€
  onPressEnter={(e) => handleSearch((e.target as HTMLInputElement).value)}  // âœ… Enteré”®è§¦å‘
/>

// handleSearchå‡½æ•°
const handleSearch = (value: string) => {
  setSearchText(value);  // âš ï¸ é‡å¤è®¾ç½®ï¼ˆå·²åœ¨onChangeä¸­è®¾ç½®ï¼‰
  setCurrentPage(1);     // é‡ç½®é¡µç 
};

// useEffectä¾èµ–
useEffect(() => {
  loadMemberFees();
}, [currentPage, pageSize, searchText, statusFilter, categoryFilter, selectedYear]);
//                         ^^^^^^^^^^
//                         âœ… searchTextåœ¨ä¾èµ–ä¸­
```

**è¡Œä¸º**:
- âœ… `onChange` æ›´æ–° `searchText` çŠ¶æ€
- âœ… `searchText` åœ¨ `useEffect` ä¾èµ–æ•°ç»„ä¸­
- âœ… çŠ¶æ€å˜åŒ– â†’ è§¦å‘ `useEffect` â†’ é‡æ–°åŠ è½½æ•°æ®
- âš ï¸ `onPressEnter` è°ƒç”¨ `handleSearch`ï¼Œä½†å®é™…ä¸Š `searchText` å·²ç»è¢« `onChange` æ›´æ–°äº†
- **ç»“æœ**: **è¾“å…¥æ—¶ç«‹å³æœç´¢** âš¡ï¼ˆä¸æ´»åŠ¨è´¢åŠ¡ç›¸åŒï¼‰

---

### **æ—¥å¸¸è´¦æˆ·æ ‡ç­¾é¡µ**

#### **ä»£ç å®ç°**
```typescript
// src/modules/finance/pages/GeneralAccountsPage/index.tsx

// æœç´¢æ¡†
<Input
  placeholder="æœç´¢äº¤æ˜“æè¿°ã€ä»˜æ¬¾äºº/æ”¶æ¬¾äººã€åˆ†ç±»..."
  value={searchText}
  onChange={(e) => setSearchText(e.target.value)}  // âœ… åªæ›´æ–°çŠ¶æ€
  // âŒ æ²¡æœ‰ onPressEnter
/>

// useEffectä¾èµ–
useEffect(() => {
  loadTransactions();
}, [transactionPage, transactionPageSize, txAccountFilter, selectedYear, selectedCategory, searchText]);
//                                                                                         ^^^^^^^^^^
//                                                                                         âœ… searchTextåœ¨ä¾èµ–ä¸­
```

**è¡Œä¸º**:
- âœ… `onChange` æ›´æ–° `searchText` çŠ¶æ€
- âœ… `searchText` åœ¨ `useEffect` ä¾èµ–æ•°ç»„ä¸­
- âœ… çŠ¶æ€å˜åŒ– â†’ è§¦å‘ `useEffect` â†’ é‡æ–°åŠ è½½æ•°æ®
- **ç»“æœ**: **è¾“å…¥æ—¶ç«‹å³æœç´¢** âš¡

---

## ğŸ’¡ çœŸç›¸æ­ç¤º

### **å®é™…æƒ…å†µ**

**æ‰€æœ‰ä¸‰ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯"è¾“å…¥æ—¶ç«‹å³æœç´¢"ï¼**

| æ ‡ç­¾é¡µ | onChangeæ›´æ–°çŠ¶æ€ | searchTextåœ¨ä¾èµ–ä¸­ | è¡Œä¸º |
|--------|-----------------|-------------------|------|
| æ´»åŠ¨è´¢åŠ¡ | âœ… | âœ… | âš¡ ç«‹å³æœç´¢ |
| ä¼šå‘˜è´¹ç”¨ | âœ… | âœ… | âš¡ ç«‹å³æœç´¢ |
| æ—¥å¸¸è´¦æˆ· | âœ… | âœ… | âš¡ ç«‹å³æœç´¢ |

### **ä¸ºä»€ä¹ˆæ„Ÿè§‰ä¸åŒï¼Ÿ**

å¯èƒ½çš„åŸå› ï¼š

1. **æ•°æ®åŠ è½½é€Ÿåº¦ä¸åŒ**
   - æ´»åŠ¨è´¢åŠ¡ï¼šæ•°æ®é‡è¾ƒå°ï¼ŒåŠ è½½å¿«
   - ä¼šå‘˜è´¹ç”¨ï¼šéœ€è¦å…³è”æŸ¥è¯¢ï¼Œç¨æ…¢
   - æ—¥å¸¸è´¦æˆ·ï¼šæ•°æ®é‡å¯èƒ½è¾ƒå¤§ï¼ŒåŠ è½½è¾ƒæ…¢

2. **LoadingçŠ¶æ€æ˜¾ç¤º**
   - å¦‚æœloadingçŠ¶æ€ä¸æ˜æ˜¾ï¼Œç”¨æˆ·å¯èƒ½æ„Ÿè§‰"æ²¡æœ‰ååº”"
   - å®é™…ä¸Šæ•°æ®æ­£åœ¨åå°åŠ è½½

3. **ç½‘ç»œå»¶è¿Ÿ**
   - ä¸åŒçš„APIè°ƒç”¨å¯èƒ½æœ‰ä¸åŒçš„å“åº”æ—¶é—´
   - FirestoreæŸ¥è¯¢å¤æ‚åº¦ä¸åŒ

## ğŸ” è¯¦ç»†åˆ†æ

### **ReactçŠ¶æ€æ›´æ–°å’ŒuseEffectæœºåˆ¶**

```
ç”¨æˆ·è¾“å…¥ "å¼ ä¸‰"
        â†“
onChangeäº‹ä»¶è§¦å‘
        â†“
setSearchText("å¼ ä¸‰")
        â†“
searchText çŠ¶æ€æ›´æ–°
        â†“
useEffect æ£€æµ‹åˆ° searchText ä¾èµ–å˜åŒ–
        â†“
æ‰§è¡Œ loadData() å‡½æ•°
        â†“
å‘èµ· Firestore æŸ¥è¯¢
        â†“
ç­‰å¾…æ•°æ®è¿”å›ï¼ˆå¯èƒ½å‡ ç™¾æ¯«ç§’åˆ°å‡ ç§’ï¼‰
        â†“
setData(newData)
        â†“
ç•Œé¢é‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç¤ºæœç´¢ç»“æœ
```

### **ä¼šå‘˜è´¹ç”¨æ ‡ç­¾é¡µçš„ onPressEnter**

```typescript
onPressEnter={(e) => handleSearch((e.target as HTMLInputElement).value)}
```

è¿™ä¸ªå®é™…ä¸Šæ˜¯**å†—ä½™çš„**ï¼Œå› ä¸ºï¼š
1. `onChange` å·²ç»æ›´æ–°äº† `searchText`
2. `searchText` åœ¨ `useEffect` ä¾èµ–ä¸­
3. çŠ¶æ€æ›´æ–°ä¼šè‡ªåŠ¨è§¦å‘æœç´¢

`handleSearch` å‡½æ•°åªæ˜¯é¢å¤–åšäº† `setCurrentPage(1)`ï¼Œä½†è¿™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸æ˜¯å¿…éœ€çš„ã€‚

## ğŸ“‹ éªŒè¯æ–¹æ³•

### **æµ‹è¯•æ­¥éª¤**

1. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·**
2. **åœ¨Consoleä¸­æ·»åŠ æ—¥å¿—**
3. **åœ¨ä¸‰ä¸ªé¡µé¢çš„æœç´¢æ¡†ä¸­è¾“å…¥æ–‡å­—**
4. **è§‚å¯ŸConsoleè¾“å‡º**

é¢„æœŸä¼šçœ‹åˆ°ï¼š
```
ç”¨æˆ·è¾“å…¥ "a"
â†’ loadData() è¢«è°ƒç”¨

ç”¨æˆ·è¾“å…¥ "ab"
â†’ loadData() è¢«è°ƒç”¨

ç”¨æˆ·è¾“å…¥ "abc"
â†’ loadData() è¢«è°ƒç”¨
```

**æ‰€æœ‰ä¸‰ä¸ªé¡µé¢éƒ½åº”è¯¥æœ‰ç›¸åŒçš„è¡Œä¸ºï¼**

## âš ï¸ å¯èƒ½çš„è¯¯è§£æ¥æº

### **1. LoadingçŠ¶æ€ä¸æ˜æ˜¾**
```typescript
// å¦‚æœæ²¡æœ‰æ˜ç¡®çš„loadingæŒ‡ç¤ºå™¨
// ç”¨æˆ·å¯èƒ½æ„Ÿè§‰"æ²¡æœ‰ååº”"

// æ´»åŠ¨è´¢åŠ¡
{loading ? <LoadingSpinner /> : <Table ... />}

// ä¼šå‘˜è´¹ç”¨å’Œæ—¥å¸¸è´¦æˆ·
// å¯èƒ½loadingçŠ¶æ€ä¸å¤Ÿæ˜æ˜¾
```

### **2. æ•°æ®é‡å·®å¼‚**

| é¡µé¢ | å…¸å‹æ•°æ®é‡ | åŠ è½½æ—¶é—´ |
|------|-----------|---------|
| æ´»åŠ¨è´¢åŠ¡åˆ—è¡¨ | 10-50ä¸ªæ´»åŠ¨ | å¿« âš¡ |
| æ´»åŠ¨è´¢åŠ¡äº¤æ˜“ | 100-500ç¬”äº¤æ˜“ | ä¸­ç­‰ |
| ä¼šå‘˜è´¹ç”¨ | 50-200æ¡è®°å½• | ä¸­ç­‰ |
| æ—¥å¸¸è´¦æˆ· | 200-1000ç¬”äº¤æ˜“ | æ…¢ ğŸŒ |

### **3. æœç´¢è¿‡æ»¤ä½ç½®**

| é¡µé¢ | è¿‡æ»¤ä½ç½® | è¯´æ˜ |
|------|---------|------|
| æ´»åŠ¨è´¢åŠ¡åˆ—è¡¨ | æœåŠ¡ç«¯ + å®¢æˆ·ç«¯ | loadEventFinancialsä¸­å®¢æˆ·ç«¯è¿‡æ»¤ |
| æ´»åŠ¨è´¢åŠ¡äº¤æ˜“ | å®¢æˆ·ç«¯ | loadTransactionsä¸­å®¢æˆ·ç«¯è¿‡æ»¤ |
| ä¼šå‘˜è´¹ç”¨ | æœåŠ¡ç«¯ | getMemberFeesæ¥æ”¶searchå‚æ•° |
| æ—¥å¸¸è´¦æˆ· | å®¢æˆ·ç«¯ | loadTransactionsä¸­å®¢æˆ·ç«¯è¿‡æ»¤ |

## ğŸ¯ ç»“è®º

### **å®é™…è¡Œä¸º**
**æ‰€æœ‰ä¸‰ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯"è¾“å…¥æ—¶ç«‹å³æœç´¢"ï¼**

å®ƒä»¬ä½¿ç”¨ç›¸åŒçš„Reactæ¨¡å¼ï¼š
```typescript
onChange={(e) => setSearchText(e.target.value)}
```
+
```typescript
useEffect(() => {
  loadData();
}, [..., searchText]);
```

### **æ„ŸçŸ¥å·®å¼‚çš„åŸå› **

1. **æ•°æ®åŠ è½½é€Ÿåº¦** - æ•°æ®é‡å’ŒæŸ¥è¯¢å¤æ‚åº¦ä¸åŒ
2. **Loadingåé¦ˆ** - LoadingçŠ¶æ€æ˜¾ç¤ºæ˜¯å¦æ˜æ˜¾
3. **ç½‘ç»œå»¶è¿Ÿ** - APIå“åº”æ—¶é—´ä¸åŒ
4. **ç¼“å­˜æœºåˆ¶** - æŸäº›é¡µé¢å¯èƒ½æœ‰ç¼“å­˜

### **å»ºè®®**

å¦‚æœç”¨æˆ·è§‰å¾—æŸä¸ªé¡µé¢æœç´¢"ä¸å¤Ÿå¿«"ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **æ·»åŠ é˜²æŠ–ï¼ˆDebounceï¼‰**
   ```typescript
   // å»¶è¿Ÿ300msåå†æœç´¢ï¼Œé¿å…æ¯æ¬¡è¾“å…¥éƒ½è§¦å‘
   const debouncedSearch = useDebounce(searchText, 300);
   ```

2. **ä¼˜åŒ–Loadingåé¦ˆ**
   ```typescript
   // æ˜¾ç¤ºæ˜ç¡®çš„æœç´¢ä¸­çŠ¶æ€
   {searching && <Spin tip="æœç´¢ä¸­..." />}
   ```

3. **å®¢æˆ·ç«¯æœç´¢ä¼˜å…ˆ**
   - å…ˆåœ¨å·²åŠ è½½æ•°æ®ä¸­æœç´¢ï¼ˆå³æ—¶åé¦ˆï¼‰
   - å†å‘èµ·æœåŠ¡ç«¯æœç´¢ï¼ˆå®Œæ•´ç»“æœï¼‰

---

**åˆ†ææ—¶é—´**: 2025-01-13  
**åˆ†æäººå‘˜**: AI Assistant  
**ç»“è®º**: âœ… ä¸‰ä¸ªé¡µé¢æœç´¢è¡Œä¸ºå®Œå…¨ä¸€è‡´ï¼Œéƒ½æ˜¯å®æ—¶æœç´¢  
**å·®å¼‚æ¥æº**: æ•°æ®åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·æ„ŸçŸ¥ï¼Œè€Œéä»£ç å®ç°
