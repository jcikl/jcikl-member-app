# æ ‘å½¢è§†å›¾æ—¥æœŸèŒƒå›´å’Œç»Ÿè®¡æ é€»è¾‘åˆ†æ

**åˆ†ææ—¶é—´**: 2025-01-13  
**åˆ†æèŒƒå›´**: äº¤æ˜“ç®¡ç†é¡µé¢æ ‘å½¢è§†å›¾æ ‡ç­¾é¡µ

---

## ğŸ“‹ ç›®å½•

1. [æ—¥æœŸèŒƒå›´ç±»å‹](#æ—¥æœŸèŒƒå›´ç±»å‹)
2. [ç»Ÿè®¡æ è®¡ç®—é€»è¾‘](#ç»Ÿè®¡æ è®¡ç®—é€»è¾‘)
3. [ä¸‰ç§æ—¥æœŸèŒƒå›´çš„å®ç°](#ä¸‰ç§æ—¥æœŸèŒƒå›´çš„å®ç°)
4. [æ•°æ®æµç¨‹å›¾](#æ•°æ®æµç¨‹å›¾)
5. [ä»£ç ä½ç½®](#ä»£ç ä½ç½®)

---

## ğŸ—“ï¸ æ—¥æœŸèŒƒå›´ç±»å‹

### ä¸‰ç§æ—¥æœŸèŒƒå›´

```typescript
treeDateRangeType: 'fiscal' | 'calendar' | 'all'
```

| ç±»å‹ | è¯´æ˜ | æ—¶é—´èŒƒå›´ |
|------|------|---------|
| `'all'` | å…¨éƒ¨ | æ‰€æœ‰æ•°æ® |
| `'fiscal'` | è´¢å¹´ï¼ˆåŸºäºé…ç½®ï¼‰ | åŸºäºè´¢å¹´é…ç½®çš„èµ·å§‹å’Œç»“æŸæ—¥æœŸ |
| `'calendar'` | è‡ªç„¶å¹´ï¼ˆ1æœˆ-12æœˆï¼‰ | 1æœˆ1æ—¥ è‡³ 12æœˆ31æ—¥ |

---

## ğŸ“Š ç»Ÿè®¡æ è®¡ç®—é€»è¾‘

### ç»Ÿè®¡æ•°æ®å®šä¹‰

```typescript
const [treeStatistics, setTreeStatistics] = useState<{
  totalIncome: number;    // æ€»æ”¶å…¥
  totalExpense: number;   // æ€»æ”¯å‡º
  surplus: number;        // ç›ˆä½™ï¼ˆæ”¶å…¥ - æ”¯å‡ºï¼‰
}>({ totalIncome: 0, totalExpense: 0, surplus: 0 });
```

### è®¡ç®—æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              buildTreeData() å‡½æ•°                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  1. åŠ è½½æ‰€æœ‰äº¤æ˜“ loadAllTransactionsForTreeView()   â”‚
â”‚     â””â”€> è¿‡æ»¤æ‰è™šæ‹Ÿå­äº¤æ˜“ (!t.isVirtual)            â”‚
â”‚                                                     â”‚
â”‚  2. æ ¹æ®æ—¥æœŸèŒƒå›´ç±»å‹è¿‡æ»¤äº¤æ˜“                        â”‚
â”‚     â”œâ”€> treeDateRangeType === 'all'                â”‚
â”‚     â”‚   â””â”€> ä¸è¿‡æ»¤ï¼ˆä¿ç•™æ‰€æœ‰æ•°æ®ï¼‰                  â”‚
â”‚     â”‚                                                     â”‚
â”‚     â”œâ”€> treeDateRangeType === 'fiscal'              â”‚
â”‚     â”‚   â””â”€> ä½¿ç”¨æ™ºèƒ½è´¢å¹´æœåŠ¡                        â”‚
â”‚     â”‚       smartFiscalYearService.                â”‚
â”‚     â”‚       detectFiscalYearPeriod(year)            â”‚
â”‚     â”‚       â””â”€> è´¢å¹´å¼€å§‹æ—¥æœŸ â‰¤ txDate â‰¤ è´¢å¹´ç»“æŸæ—¥æœŸ â”‚
â”‚     â”‚                                                     â”‚
â”‚     â””â”€> treeDateRangeType === 'calendar'           â”‚
â”‚         â””â”€> è‡ªç„¶å¹´ï¼štxYear === selectedYear        â”‚
â”‚             (1æœˆ1æ—¥ è‡³ 12æœˆ31æ—¥)                    â”‚
â”‚                                                     â”‚
â”‚  3. éå†è¿‡æ»¤åçš„äº¤æ˜“ï¼Œç´¯åŠ ç»Ÿè®¡                      â”‚
â”‚     â”œâ”€> transactionType === 'income'               â”‚
â”‚     â”‚   â””â”€> totalIncome += amount                  â”‚
â”‚     â”‚                                                     â”‚
â”‚     â””â”€> transactionType === 'expense'              â”‚
â”‚         â””â”€> totalExpense += amount                 â”‚
â”‚                                                     â”‚
â”‚  4. è®¡ç®—ç›ˆä½™                                        â”‚
â”‚     surplus = totalIncome - totalExpense           â”‚
â”‚                                                     â”‚
â”‚  5. ä¿å­˜ç»Ÿè®¡ç»“æœåˆ° treeStatistics                   â”‚
â”‚     setTreeStatistics({                            â”‚
â”‚       totalIncome,                                  â”‚
â”‚       totalExpense,                                 â”‚
â”‚       surplus,                                      â”‚
â”‚     });                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… ä¸‰ç§æ—¥æœŸèŒƒå›´çš„å®ç°

### 1. å…¨éƒ¨ (all)

**ä»£ç ä½ç½®**: Line 1614-1647

```typescript
if (treeDateRangeType !== 'all') {
  // å¦‚æœæ˜¯ 'all'ï¼Œä¸è¿‡æ»¤
  // è·³è¿‡è¿‡æ»¤é€»è¾‘
}

// ä½¿ç”¨æ‰€æœ‰äº¤æ˜“è®¡ç®—ç»Ÿè®¡
```

**ç‰¹ç‚¹**:
- âœ… æ˜¾ç¤ºæ‰€æœ‰äº¤æ˜“æ•°æ®
- âœ… ä¸æŒ‰å¹´ä»½è¿‡æ»¤
- âœ… ç»Ÿè®¡æ‰€æœ‰æ”¶å…¥å’Œæ”¯å‡º

**é€‚ç”¨åœºæ™¯**:
- æŸ¥çœ‹å®Œæ•´æ•°æ®
- ä¸éœ€è¦æŒ‰å¹´åº¦åˆ†æ

---

### 2. è´¢å¹´ (fiscal)

**ä»£ç ä½ç½®**: Line 1625-1639

```typescript
if (treeDateRangeType === 'fiscal') {
  // ä½¿ç”¨æ™ºèƒ½è´¢å¹´æœåŠ¡è®¡ç®—è´¢å¹´èŒƒå›´
  try {
    const fiscalPeriod = smartFiscalYearService.detectFiscalYearPeriod(year);
    const txDateStr = transaction.transactionDate.split('T')[0];
    return txDateStr >= fiscalPeriod.startDate && 
           txDateStr <= fiscalPeriod.endDate;
  } catch (error) {
    // å›é€€åˆ°é»˜è®¤é€»è¾‘ï¼ˆ10æœˆ1æ—¥-9æœˆ30æ—¥ï¼‰
    if (txMonth >= 10) {
      return txYear === year;  // 10-12æœˆå±äºå½“å‰è´¢å¹´
    } else {
      return txYear === year + 1;  // 1-9æœˆå±äºä¸‹ä¸€è´¢å¹´
    }
  }
}
```

**é»˜è®¤è´¢å¹´è§„åˆ™**:
- **è´¢å¹´å¼€å§‹**: 10æœˆ1æ—¥
- **è´¢å¹´ç»“æŸ**: 9æœˆ30æ—¥

**ç¤ºä¾‹**:
```
FY2024 = 2024-10-01 è‡³ 2025-09-30
```

**ç‰¹ç‚¹**:
- âœ… ä½¿ç”¨æ™ºèƒ½è´¢å¹´æœåŠ¡ï¼ˆå¯é…ç½®ï¼‰
- âœ… å›é€€æœºåˆ¶ï¼ˆ10æœˆ1æ—¥-9æœˆ30æ—¥ï¼‰
- âœ… æ˜¾ç¤ºé€‰æ‹©çš„è´¢å¹´å’Œå‰ä¸€ä¸ªè´¢å¹´

**è´¢å¹´åˆ¤æ–­é€»è¾‘**:
```
äº¤æ˜“æ—¥æœŸ 2024-11-15
è´¢å¹´é€‰æ‹©: FY2024
     â†“
10æœˆ â‰¤ 11æœˆ â‰¤ 12æœˆ â†’ å±äº FY2024 âœ…

äº¤æ˜“æ—¥æœŸ 2024-03-15
è´¢å¹´é€‰æ‹©: FY2024
     â†“
1æœˆ â‰¤ 3æœˆ â‰¤ 9æœˆ â†’ å±äº FY2025 âœ…
```

**é€‚ç”¨åœºæ™¯**:
- æŒ‰è´¢å¹´å®¡è®¡
- è´¢å¹´é¢„ç®—åˆ†æ
- è´¢åŠ¡æŠ¥å‘Š

---

### 3. è‡ªç„¶å¹´ (calendar)

**ä»£ç ä½ç½®**: Line 1640-1643

```typescript
else if (treeDateRangeType === 'calendar') {
  // è‡ªç„¶å¹´ï¼š1æœˆ1æ—¥ è‡³ 12æœˆ31æ—¥
  return txYear === year;
}
```

**è§„åˆ™**:
- **å¼€å§‹**: 1æœˆ1æ—¥
- **ç»“æŸ**: 12æœˆ31æ—¥

**ç¤ºä¾‹**:
```
2024å¹´ = 2024-01-01 è‡³ 2024-12-31
```

**ç‰¹ç‚¹**:
- âœ… ç®€å•çš„å¹´åº¦è¿‡æ»¤
- âœ… æŒ‰äº¤æ˜“å®é™…å¹´ä»½åˆ¤æ–­
- âœ… æ˜¾ç¤ºé€‰æ‹©çš„å¹´ä»½å’Œå‰ä¸€å¹´

**è‡ªç„¶å¹´åˆ¤æ–­é€»è¾‘**:
```
äº¤æ˜“æ—¥æœŸ 2024-06-15
å¹´ä»½é€‰æ‹©: 2024
     â†“
txYear === 2024 â†’ å±äº 2024å¹´ âœ…

äº¤æ˜“æ—¥æœŸ 2025-02-15
å¹´ä»½é€‰æ‹©: 2024
     â†“
txYear === 2025 â†’ ä¸å±äº 2024å¹´ âŒ
```

**é€‚ç”¨åœºæ™¯**:
- è‡ªç„¶å¹´åº¦å¯¹æ¯”
- å¹´åº¦æ€»ç»“
- æŒ‰å…¬å†å¹´åº¦åˆ†æ

---

## ğŸ“Š ç»Ÿè®¡æ æ˜¾ç¤º

### UI æ¸²æŸ“

```typescript
<Row gutter={24}>
  <Col span={8}>
    <div style={{ textAlign: 'center' }}>
      <div style={{ fontSize: 14, color: '#666', marginBottom: 8 }}>
        Total Incomes
      </div>
      <div style={{ fontSize: 28, fontWeight: 600, color: '#52c41a' }}>
        RM {treeStatistics.totalIncome.toFixed(2)}
      </div>
    </div>
  </Col>
  
  <Col span={8}>
    <div style={{ textAlign: 'center' }}>
      <div style={{ fontSize: 14, color: '#666', marginBottom: 8 }}>
        Total Expenses
      </div>
      <div style={{ fontSize: 28, fontWeight: 600, color: '#ff4d4f' }}>
        RM {treeStatistics.totalExpense.toFixed(2)}
      </div>
    </div>
  </Col>
  
  <Col span={8}>
    <div style={{ textAlign: 'center' }}>
      <div style={{ fontSize: 14, color: '#666', marginBottom: 8 }}>
        {treeStatistics.surplus >= 0 ? 'Surplus' : 'Deficit'}
      </div>
      <div style={{ 
        fontSize: 28,
        fontWeight: 600,
        color: treeStatistics.surplus >= 0 ? '#52c41a' : '#ff4d4f'
      }}>
        RM {Math.abs(treeStatistics.surplus).toFixed(2)}
      </div>
    </div>
  </Col>
</Row>
```

### ç»Ÿè®¡æ å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»Ÿè®¡æ  (Statistics Card)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Total Incomes   â”‚  Total Expenses  â”‚  Surplus      â”‚
â”‚  (æ€»æ”¶å…¥)         â”‚  (æ€»æ”¯å‡º)         â”‚  (ç›ˆä½™/äºæŸ)   â”‚
â”‚                  â”‚                  â”‚               â”‚
â”‚  RM 1,234,567.89 â”‚  RM 987,654.32   â”‚  RM 246,913.57â”‚
â”‚  (ç»¿è‰²)          â”‚  (çº¢è‰²)          â”‚  (ç»¿è‰²/çº¢è‰²)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®æµç¨‹å›¾

### å®Œæ•´çš„ç»Ÿè®¡è®¡ç®—æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ—¥æœŸèŒƒå›´
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ treeDateRangeType å’Œ treeSelectedYear â”‚
â”‚ â€¢ 'all' | 'fiscal' | 'calendar'    â”‚
â”‚ â€¢ é€‰æ‹©å¹´ä»½ (e.g. "2024")           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§¦å‘ useEffect                     â”‚
â”‚ (treeDateRangeType æˆ–              â”‚
â”‚  treeSelectedYear å˜åŒ–)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ buildTreeData() å‡½æ•°æ‰§è¡Œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½æ‰€æœ‰äº¤æ˜“                    â”‚
â”‚    loadAllTransactionsForTreeView()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¿‡æ»¤è™šæ‹Ÿäº¤æ˜“                    â”‚
â”‚    filter(!t.isVirtual)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ ¹æ®æ—¥æœŸèŒƒå›´ç±»å‹è¿‡æ»¤äº¤æ˜“        â”‚
â”‚                                    â”‚
â”‚ if (treeDateRangeType === 'all')   â”‚
â”‚   â†’ ä¸è¿‡æ»¤                         â”‚
â”‚                                    â”‚
â”‚ if (treeDateRangeType === 'fiscal')â”‚
â”‚   â†’ è´¢å¹´èŒƒå›´è¿‡æ»¤                  â”‚
â”‚     2024-10-01 â‰¤ txDate â‰¤ 2025-09-30 â”‚
â”‚                                    â”‚
â”‚ if (treeDateRangeType === 'calendar')â”‚
â”‚   â†’ è‡ªç„¶å¹´è¿‡æ»¤                     â”‚
â”‚     txYear === 2024                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. éå†äº¤æ˜“ï¼Œç´¯åŠ ç»Ÿè®¡              â”‚
â”‚                                    â”‚
â”‚ for each transaction:             â”‚
â”‚   if (transactionType === 'income') â”‚
â”‚     totalIncome += amount          â”‚
â”‚   else                             â”‚
â”‚     totalExpense += amount        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è®¡ç®—ç›ˆä½™                        â”‚
â”‚    surplus = totalIncome - totalExpenseâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ›´æ–° treeStatistics            â”‚
â”‚    setTreeStatistics({            â”‚
â”‚      totalIncome,                 â”‚
â”‚      totalExpense,                â”‚
â”‚      surplus                      â”‚
â”‚    })                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. UI è‡ªåŠ¨åˆ·æ–°ï¼Œæ˜¾ç¤ºç»Ÿè®¡æ          â”‚
â”‚    â€¢ Total Incomes                â”‚
â”‚    â€¢ Total Expenses               â”‚
â”‚    â€¢ Surplus / Deficit            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å…³é”®ä»£ç ä½ç½®

### 1. çŠ¶æ€å®šä¹‰ (Line 103-110)

```typescript
const [treeDateRangeType, setTreeDateRangeType] = useState<'fiscal' | 'calendar' | 'all'>('all');
const [treeSelectedYear, setTreeSelectedYear] = useState<string>(new Date().getFullYear().toString());
const [treeStatistics, setTreeStatistics] = useState<{
  totalIncome: number;
  totalExpense: number;
  surplus: number;
}>({ totalIncome: 0, totalExpense: 0, surplus: 0 });
```

### 2. æ—¥æœŸè¿‡æ»¤é€»è¾‘ (Line 1614-1647)

```typescript
if (treeDateRangeType !== 'all') {
  const year = parseInt(treeSelectedYear);
  
  realTransactions = realTransactions.filter(transaction => {
    // è´¢å¹´è¿‡æ»¤æˆ–è‡ªç„¶å¹´è¿‡æ»¤
  });
}
```

### 3. ç»Ÿè®¡ç´¯åŠ  (Line 1663-2076)

```typescript
// åœ¨ buildTreeData() å‡½æ•°ä¸­
transactions.forEach(transaction => {
  if (transaction.transactionType === 'income') {
    totalIncome += amount;
  } else {
    totalExpense += amount;
  }
});

setTreeStatistics({
  totalIncome,
  totalExpense,
  surplus: totalIncome - totalExpense,
});
```

### 4. é‡æ–°æ„å»ºè§¦å‘ (Line 2093-2097)

```typescript
useEffect(() => {
  if (viewMode === 'tree') {
    buildTreeData();
  }
}, [treeDateRangeType, treeSelectedYear, viewMode]);
```

### 5. UI æ˜¾ç¤º (Line 2767-2807)

```typescript
<Card>
  <Row gutter={24}>
    <Col span={8}>æ€»æ”¶å…¥</Col>
    <Col span={8}>æ€»æ”¯å‡º</Col>
    <Col span={8}>ç›ˆä½™/äºæŸ</Col>
  </Row>
</Card>
```

---

## ğŸ¯ æ€»ç»“

### æ—¥æœŸèŒƒå›´å¯¹æ¯”

| ç‰¹å¾ | å…¨éƒ¨ (all) | è´¢å¹´ (fiscal) | è‡ªç„¶å¹´ (calendar) |
|------|-----------|--------------|-----------------|
| **èµ·å§‹æ—¥æœŸ** | - | åŸºäºé…ç½® | 1æœˆ1æ—¥ |
| **ç»“æŸæ—¥æœŸ** | - | åŸºäºé…ç½® | 12æœˆ31æ—¥ |
| **é»˜è®¤è§„åˆ™** | - | 10æœˆ1æ—¥ | - |
| **ç‰¹æ®Šé€»è¾‘** | - | æ™ºèƒ½è´¢å¹´æœåŠ¡ | - |
| **é€‚ç”¨åœºæ™¯** | æ•´ä½“åˆ†æ | å®¡è®¡æŠ¥å‘Š | å¹´åº¦å¯¹æ¯” |

### ç»Ÿè®¡æ è®¡ç®—è§„åˆ™

1. è¿‡æ»¤æ•°æ®: æ ¹æ® `treeDateRangeType` è¿‡æ»¤äº¤æ˜“
2. ç´¯åŠ ç»Ÿè®¡: éå†è¿‡æ»¤åçš„äº¤æ˜“ï¼Œåˆ†åˆ«ç´¯åŠ æ”¶å…¥å’Œæ”¯å‡º
3. è®¡ç®—ç›ˆä½™: `surplus = totalIncome - totalExpense`
4. è‡ªåŠ¨åˆ·æ–°: ç»Ÿè®¡æ éšæ—¥æœŸèŒƒå›´å˜åŒ–è‡ªåŠ¨æ›´æ–°

### å…³é”®è®¾è®¡

- âœ… çµæ´»çš„æ—¥æœŸèŒƒå›´é€‰æ‹©
- âœ… æ™ºèƒ½è´¢å¹´æœåŠ¡æ”¯æŒé…ç½®åŒ–
- âœ… å›é€€æœºåˆ¶ç¡®ä¿å…¼å®¹æ€§
- âœ… å®æ—¶ç»Ÿè®¡æ›´æ–°
- âœ… æ¸…æ™°çš„ UI å±•ç¤º

