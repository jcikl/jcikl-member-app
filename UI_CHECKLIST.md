# ✅ 交易管理页面 UI 检查清单

## 📋 页面结构检查

### 1. 页面标题栏
```
┌─────────────────────────────────────────────┐
│ 交易管理                                    │
│ 按银行账户查看和管理所有财务交易            │
│                                             │
│ 首页 > 财务管理 > 交易管理                  │
└─────────────────────────────────────────────┘
```
- [ ] 标题显示正确
- [ ] 副标题显示正确
- [ ] 面包屑导航正确

---

### 2. 银行账户标签页
```
┌─────────────────────────────────────────────┐
│ [所有账户 285] [Main Account RM14457 285]  │
│                    当前显示: 285 条交易     │
└─────────────────────────────────────────────┘
```
- [ ] "所有账户"标签显示
- [ ] 各银行账户标签显示
- [ ] 账户余额显示正确
- [ ] 交易数量显示正确
- [ ] 默认账户有"默认"标签

---

### 3. 筛选栏
```
┌─────────────────────────────────────────────┐
│ [🔍 搜索...] [类别▼] [状态▼] [新交易]     │
└─────────────────────────────────────────────┘
```
- [ ] 搜索框显示正确
- [ ] 搜索框占位符：`搜索描述、金额、类别、状态...`
- [ ] 类别下拉显示所有选项
- [ ] 状态下拉显示所有选项
- [ ] "新交易"按钮在右侧

---

### 4. 交易列表表格
```
┌──────────────────────────────────────────────────────────────┐
│ □ 日期      描述              金额      累计余额  类别  操作│
├──────────────────────────────────────────────────────────────┤
│ ☑ 19-Jul  银行转账[已拆分3]  +1000    37372    -    [撤销]│
│   ☐ └─会员费-RM300[子项]      300      -       会员  [查看]│
│   ☐ └─活动-RM500[子项]        500      -       活动  [查看]│
│   ☐ └─未分配[子项][未分配]    200      -       未分  [查看]│
│ ☑ 12-Jul  打印费用           -2200    37022    日常  [拆分]│
└──────────────────────────────────────────────────────────────┘
```

**检查项**：
- [ ] 表头显示完整
- [ ] 复选框列显示
- [ ] 日期格式正确（DD-MMM-YYYY）
- [ ] 描述列宽度合适
- [ ] 金额列右对齐
- [ ] 累计余额列右对齐
- [ ] 类别列显示
- [ ] 操作列显示完整

#### 父交易显示
- [ ] 正常交易有"拆分"按钮
- [ ] 已拆分交易有 `[已拆分 N]` 橙色标签
- [ ] 已拆分交易有"撤销"红色按钮
- [ ] 累计余额显示（绿色/红色）
- [ ] 复选框可用

#### 子交易显示
- [ ] 有 `└─` 缩进符号
- [ ] 描述为灰色斜体
- [ ] 有 `[子项]` 蓝色标签
- [ ] 未分配金额有额外的 `[未分配]` 灰色标签
- [ ] 累计余额显示 `-`
- [ ] 复选框禁用（灰色）
- [ ] 只有"查看"按钮

---

### 5. 分页器
```
┌─────────────────────────────────────────────┐
│ 共 285 条记录  [每页▼] [<] 1/15 [>]       │
└─────────────────────────────────────────────┘
```
- [ ] 总数显示正确
- [ ] 页码显示正确
- [ ] 每页条数选择器可用
- [ ] 翻页按钮可用

---

### 6. 批量操作栏（底部浮动）
```
┌──────────────────────────────────────────────────────────┐
│ 已选择 5 项                                              │
│ [批量拆分] [设置类别] [导出] [删除]  [全选] [取消选择]   │
└──────────────────────────────────────────────────────────┘
```
**显示条件**：选择 ≥ 1 条交易时显示

- [ ] 选择数量显示正确
- [ ] "批量拆分"按钮显示
- [ ] "设置类别"按钮显示
- [ ] "导出"按钮显示
- [ ] "删除"按钮显示（红色）
- [ ] "全选"按钮可用
- [ ] "取消选择"按钮可用
- [ ] 位置：固定在页面底部

---

## 🔀 拆分功能 UI 检查

### 7. 单个拆分弹窗
```
┌────────────────────────────────────────────┐
│      拆分交易  [RM 1000.00]                │
├────────────────────────────────────────────┤
│ [原交易信息]      [拆分统计]              │
│ 日期: 01-Jan      原: 1000                 │
│ 描述: 银行转账    已: 800                  │
│ 类型: 收入        未: 200⚠️                │
│ 金额: RM1000                               │
│                   💡自动创建未分配          │
│                                            │
│ ───── 拆分明细 ─────                       │
│                                            │
│ 拆分项1              [删除]                │
│ 金额* [300] 类别* [会员费▼]               │
│ 备注  [张三____]                           │
│                                            │
│ [+ 添加拆分项]                             │
│                                            │
│        [取消]    [确认拆分]                │
└────────────────────────────────────────────┘
```

**检查项**：
- [ ] 标题显示交易金额
- [ ] 原交易信息和拆分统计左右并排
- [ ] 拆分统计实时更新
- [ ] 未分配金额有警告提示
- [ ] 金额输入框有 RM 前缀
- [ ] 类别下拉只有3个选项
- [ ] 备注为2行文本域
- [ ] "添加拆分项"按钮可用
- [ ] "删除"按钮在多个拆分项时显示
- [ ] "确认拆分"按钮在无效时禁用

---

### 8. 批量拆分弹窗
```
┌────────────────────────────────────────────┐
│  批量拆分 - 已选择 5 条交易                │
├────────────────────────────────────────────┤
│ 拆分总金额: RM 500.00                      │
│ 💡 将从每条交易中扣除此金额...             │
│                                            │
│ ───── 拆分规则（按固定金额） ─────         │
│                                            │
│ 规则1                [删除]                │
│ 金额* [300] 类别* [会员费▼]               │
│ 备注  [___]                                │
│                                            │
│ [+ 添加拆分规则]                           │
│                                            │
│ ℹ️ 说明文字...                            │
│                                            │
│        [取消]    [确认批量拆分]            │
└────────────────────────────────────────────┘
```

**检查项**：
- [ ] 标题显示选中数量
- [ ] 拆分总金额实时更新
- [ ] 金额输入框有 RM 前缀
- [ ] 类别下拉只有3个选项
- [ ] 备注为1行文本域
- [ ] 说明文字显示正确
- [ ] 按钮正常工作

---

### 9. 批量设置类别弹窗
```
┌────────────────────────────────────────────┐
│  批量设置类别 - 已选择 10 条交易           │
├────────────────────────────────────────────┤
│ ⚠️ 注意：此操作将覆盖所有选中交易的类别   │
│                                            │
│ 选择类别 *                                 │
│ [会员费 ▼]                                 │
│                                            │
│ 将为 10 条交易设置类别为：会员费           │
│                                            │
│        [取消]      [确认设置]              │
└────────────────────────────────────────────┘
```

**检查项**：
- [ ] 标题显示选中数量
- [ ] 警告提示显示
- [ ] 类别下拉只有3个选项
- [ ] 预览文字实时更新
- [ ] 未选择类别时"确认"按钮禁用

---

## 🎨 样式检查

### 颜色主题
- [ ] 收入金额：绿色 `text-success`
- [ ] 支出金额：红色 `text-danger`
- [ ] 正余额：绿色
- [ ] 负余额：红色
- [ ] 已拆分标签：橙色 `#fa8c16`
- [ ] 子项标签：蓝色 `#1890ff`
- [ ] 未分配标签：灰色 `default`

### 字体和图标
- [ ] 子交易描述：灰色斜体
- [ ] 缩进符号：`└─` 显示正确
- [ ] 各种图标显示正确：
  - 拆分：✂️ `ScissorOutlined`
  - 设置类别：🏷️ `TagOutlined`
  - 导出：📤 `ExportOutlined`
  - 删除：🗑️ `DeleteOutlined`

### 响应式
- [ ] 宽屏下显示完整
- [ ] 窄屏下可横向滚动
- [ ] 弹窗在各种屏幕尺寸下居中

---

## 🔧 功能检查

### 基础操作
- [ ] 创建交易正常
- [ ] 编辑交易正常
- [ ] 删除交易正常（有确认提示）
- [ ] 搜索功能正常
- [ ] 筛选功能正常
- [ ] 分页功能正常

### 拆分功能
- [ ] 单个拆分弹窗打开正常
- [ ] 添加拆分项正常
- [ ] 删除拆分项正常
- [ ] 金额验证正常（总额不超过原交易）
- [ ] 类别必选验证正常
- [ ] 确认拆分后子交易显示
- [ ] 撤销拆分正常

### 批量拆分
- [ ] 批量拆分弹窗打开正常
- [ ] 金额输入正常
- [ ] 类别选择正常
- [ ] 确认后批量处理正常
- [ ] 成功/失败统计显示正确

### 批量设置类别
- [ ] 批量设置类别弹窗打开正常
- [ ] 类别选择正常
- [ ] 预览文字更新正常
- [ ] 确认后类别更新正常

### 批量操作
- [ ] 多选功能正常
- [ ] 子交易复选框禁用
- [ ] 全选功能正常（只选父交易）
- [ ] 取消选择功能正常
- [ ] 翻页时选择清空
- [ ] 批量删除正常

---

## 💰 余额显示检查

### 累计余额
- [ ] 只在单个账户标签页显示
- [ ] "所有账户"标签页不显示（显示 `-`）
- [ ] 父交易显示累计余额
- [ ] 子交易显示 `-`
- [ ] 正余额为绿色
- [ ] 负余额为红色
- [ ] 金额格式：`RM 12345.67`

### 余额计算
- [ ] 跨页余额连续正确
- [ ] 同日期交易顺序正确
- [ ] 虚拟交易不影响余额

---

## 🔍 搜索和筛选检查

### 搜索功能
- [ ] 搜索描述正常
- [ ] 搜索金额正常（输入 "300"）
- [ ] 搜索类别正常（输入 "会员"）
- [ ] 搜索状态正常（输入 "pending"）
- [ ] 搜索交易类型正常（输入 "收入"）
- [ ] 清空搜索正常

### 筛选功能
- [ ] 类别筛选正常
- [ ] 状态筛选正常
- [ ] 组合筛选正常（搜索+类别+状态）

---

## 🎯 子交易显示检查

### 层级显示
- [ ] 子交易在父交易下方
- [ ] 有 `└─` 缩进符号
- [ ] 子交易描述为灰色斜体
- [ ] 标签显示正确：
  - [ ] 父交易：`[已拆分 N]` 橙色
  - [ ] 子交易：`[子项]` 蓝色
  - [ ] 未分配：`[未分配]` 灰色

### 子交易内容
- [ ] 描述格式：`类别 - RM 金额`
  - 例如：`会员费 - RM 300.00`
- [ ] 金额显示正确
- [ ] 类别显示正确
- [ ] 累计余额显示 `-`

### 操作按钮
- [ ] 父交易（未拆分）：查看、批准、拆分、编辑、删除
- [ ] 父交易（已拆分）：查看、批准、撤销、编辑、删除
- [ ] 子交易：只有查看

### 多选行为
- [ ] 父交易可选择
- [ ] 子交易复选框禁用（灰色）
- [ ] 全选时只选父交易

---

## 🔀 拆分功能检查

### 单个拆分
1. [ ] 点击"拆分"打开弹窗
2. [ ] 原交易信息显示正确（左侧）
3. [ ] 拆分统计实时更新（右侧）
4. [ ] 添加拆分项正常
5. [ ] 删除拆分项正常
6. [ ] 金额验证正常
7. [ ] 类别必选验证正常
8. [ ] 确认拆分正常
9. [ ] 拆分后显示效果：
   - [ ] 父交易有 `[已拆分 N]` 标签
   - [ ] 父交易类别被清除
   - [ ] 子交易显示在下方
   - [ ] 未分配金额自动创建（如有）

### 撤销拆分
1. [ ] 已拆分交易有"撤销"按钮
2. [ ] 点击撤销有二次确认
3. [ ] 确认后所有子交易删除
4. [ ] 父交易恢复为普通交易
5. [ ] `[已拆分]` 标签消失
6. [ ] 类别保持为空

### 批量拆分
1. [ ] 选择多条交易
2. [ ] 点击"批量拆分"打开弹窗
3. [ ] 标题显示选中数量
4. [ ] 拆分总金额实时更新
5. [ ] 添加/删除规则正常
6. [ ] 金额验证正常
7. [ ] 类别验证正常
8. [ ] 确认后批量处理
9. [ ] 成功/失败统计显示
10. [ ] 所有成功的交易显示子交易

---

## 📱 响应式检查

### 桌面端（> 1200px）
- [ ] 所有列完整显示
- [ ] 不需要横向滚动
- [ ] 弹窗居中显示

### 平板端（768px - 1200px）
- [ ] 表格可横向滚动
- [ ] 操作列固定在右侧
- [ ] 弹窗适配宽度

### 手机端（< 768px）
- [ ] 表格可横向滚动
- [ ] 关键列可见
- [ ] 弹窗全屏显示

---

## ⚡ 性能检查

### 加载速度
- [ ] 初始加载 < 2秒
- [ ] 切换标签页 < 1秒
- [ ] 搜索响应 < 0.5秒
- [ ] 翻页响应 < 0.5秒

### 交互流畅度
- [ ] 拆分弹窗打开流畅
- [ ] 添加拆分项无卡顿
- [ ] 批量操作响应及时
- [ ] 列表滚动流畅

---

## 🐛 常见问题检查

### 问题 1：子交易不显示
**检查**：
- [ ] `includeVirtual: true` 已设置
- [ ] 刷新页面
- [ ] 检查控制台错误

### 问题 2：子交易和父交易分离
**检查**：
- [ ] 智能分组逻辑已实现
- [ ] 排序逻辑正确

### 问题 3：累计余额计算错误
**检查**：
- [ ] `getBalanceBeforeDate` 过滤虚拟交易
- [ ] `calculatePageBalances` 只计算父交易

### 问题 4：批量操作失败
**检查**：
- [ ] 虚拟交易自动跳过
- [ ] 已拆分交易跳过（批量拆分）
- [ ] 错误提示清晰

---

## 🎯 关键交互流程检查

### 流程 1：完整拆分流程
```
1. [ ] 选择一笔普通交易
2. [ ] 点击"拆分"按钮
3. [ ] 弹窗打开
4. [ ] 填写拆分项（金额、类别、备注）
5. [ ] 观察拆分统计更新
6. [ ] 点击"确认拆分"
7. [ ] 弹窗关闭
8. [ ] 列表刷新
9. [ ] 父交易显示 [已拆分] 标签
10. [ ] 子交易显示在下方
11. [ ] 累计余额正确
```

### 流程 2：批量拆分流程
```
1. [ ] 选择多条交易（如5条）
2. [ ] 批量操作栏显示
3. [ ] 点击"批量拆分"
4. [ ] 弹窗打开，显示选中数量
5. [ ] 填写拆分规则（金额、类别）
6. [ ] 点击"确认批量拆分"
7. [ ] 弹窗关闭
8. [ ] 显示成功/失败统计
9. [ ] 列表刷新
10. [ ] 所有成功的交易显示子交易
```

### 流程 3：批量设置类别流程
```
1. [ ] 选择多条交易
2. [ ] 点击"设置类别"
3. [ ] 弹窗打开
4. [ ] 选择类别
5. [ ] 观察预览文字更新
6. [ ] 点击"确认设置"
7. [ ] 弹窗关闭
8. [ ] 显示成功统计
9. [ ] 列表刷新
10. [ ] 类别列显示新类别
```

---

## 📊 数据一致性检查

### 余额一致性
- [ ] 银行账户余额 = ∑(非虚拟交易金额)
- [ ] 累计余额连续正确
- [ ] 删除交易后余额正确回退

### 拆分数据一致性
- [ ] 父交易金额 = ∑(子交易金额)
- [ ] 父交易 `splitCount` = 子交易数量
- [ ] 父交易 `allocatedAmount` + `unallocatedAmount` = `amount`

### 类别一致性
- [ ] 拆分后父交易类别为空
- [ ] 子交易各有独立类别
- [ ] 撤销拆分后父交易类别仍为空

---

## 🎓 测试用例

### 测试用例 1：标准拆分
```
输入：
  - 交易金额: RM 1000
  - 拆分项1: 300, 会员费
  - 拆分项2: 500, 活动财务

预期结果：
  ✅ 3个子交易（300 + 500 + 200未分配）
  ✅ 父交易类别清除
  ✅ 累计余额不变（+1000）
```

### 测试用例 2：完全分配
```
输入：
  - 交易金额: RM 1050
  - 拆分项1: 350, 会员费
  - 拆分项2: 350, 会员费
  - 拆分项3: 350, 会员费

预期结果：
  ✅ 3个子交易（无未分配）
  ✅ splitCount = 3
  ✅ unallocatedAmount = 0
```

### 测试用例 3：批量拆分
```
输入：
  - 选中: 5条交易（金额不同）
  - 规则: RM 300 会员费 + RM 200 活动财务

预期结果：
  ✅ 金额充足的交易成功拆分
  ✅ 金额不足的交易失败并跳过
  ✅ 显示成功/失败统计
```

---

## 🚀 UI 优化建议（可选）

### 已实现 ✅
- 拆分弹窗左右布局
- 移除冗余提示
- 简化拆分字段（只需金额、类别、备注）
- 批量拆分按固定金额
- 智能分组分页

### 未来可选 💡
- [ ] 拆分明细折叠/展开
- [ ] 批量操作进度条
- [ ] 拆分规则模板保存
- [ ] 子交易快速查看悬浮框
- [ ] 深色模式支持

---

## 📞 问题排查

### 如果子交易不显示
1. 检查浏览器控制台错误
2. 刷新页面（Ctrl+R）
3. 清除浏览器缓存
4. 检查 `includeVirtual: true` 是否设置

### 如果余额计算错误
1. 检查虚拟交易是否被正确过滤
2. 查看控制台的余额计算日志
3. 验证初始余额是否正确

### 如果批量操作失败
1. 检查选中的交易是否有虚拟交易
2. 查看控制台错误信息
3. 检查权限设置

---

**使用此清单逐项检查 UI，确保所有功能正常运行！** ✅

