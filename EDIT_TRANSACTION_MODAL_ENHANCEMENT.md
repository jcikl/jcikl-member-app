# äº¤æ˜“ç®¡ç†ç¼–è¾‘å¼¹çª—å¢å¼ºåŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å‡çº§äº†äº¤æ˜“ç®¡ç†é¡µé¢çš„ç¼–è¾‘/åˆ›å»ºäº¤æ˜“å¼¹çª—ï¼Œæ–°å¢ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **ä¼šå‘˜/éä¼šå‘˜é€‰æ‹©** - ä»˜æ¬¾äºº/æ”¶æ¬¾äººæ”¯æŒä¼šå‘˜é€‰æ‹©æˆ–æ‰‹åŠ¨è¾“å…¥
2. **åŠ¨æ€äºŒæ¬¡åˆ†ç±»** - æ ¹æ®ä¸»è¦ç±»åˆ«è‡ªåŠ¨è°ƒæ•´äºŒæ¬¡åˆ†ç±»é€‰é¡¹

---

## ğŸ“‹ åŠŸèƒ½è¯¦æƒ…

### 1. ä¼šå‘˜/éä¼šå‘˜é€‰æ‹©

#### åŠŸèƒ½æè¿°
ä»˜æ¬¾äºº/æ”¶æ¬¾äººç°åœ¨æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
- **ä¼šå‘˜æ¨¡å¼**ï¼šä»ä¼šå‘˜åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œè‡ªåŠ¨å…³è”ä¼šå‘˜ID
- **éä¼šå‘˜æ¨¡å¼**ï¼šæ‰‹åŠ¨è¾“å…¥ä»˜æ¬¾äºº/æ”¶æ¬¾äººåç§°

#### ä½¿ç”¨åœºæ™¯
- **ä¼šå‘˜æ¨¡å¼**ï¼šä¼šå‘˜ç¼´è´¹ã€ä¼šå‘˜é—´äº¤æ˜“ã€ç»™ä¼šå‘˜ä»˜æ¬¾ç­‰
- **éä¼šå‘˜æ¨¡å¼**ï¼šä¾›åº”å•†ä»˜æ¬¾ã€æœºæ„åˆä½œã€è®¿å®¢æ”¶è´¹ç­‰

#### æ•°æ®ç»“æ„
```typescript
interface Transaction {
  payerPayee?: string;  // ä»˜æ¬¾äºº/æ”¶æ¬¾äººå§“å
  payerId?: string;     // ä»˜æ¬¾äºº/æ”¶æ¬¾äººIDï¼ˆå¦‚æœæ˜¯ä¼šå‘˜ï¼‰
}
```

#### UIäº¤äº’
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹©ç±»å‹                             â”‚
â”‚ â—‹ ä¼šå‘˜   â—‹ éä¼šå‘˜ï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ä¼šå‘˜æ¨¡å¼ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹©ä¼šå‘˜ *                           â”‚
â”‚ â–¼ [æœç´¢ä¼šå‘˜...]                      â”‚
â”‚   - å¼ ä¸‰ - zhang@example.com        â”‚
â”‚   - æå›› - li@example.com           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€éä¼šå‘˜æ¨¡å¼ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»˜æ¬¾äºº/æ”¶æ¬¾äºº                        â”‚
â”‚ [ä¾‹å¦‚: ä¾›åº”å•†åç§°ã€æœºæ„åç§°ç­‰]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. åŠ¨æ€äºŒæ¬¡åˆ†ç±»

#### åŠŸèƒ½æè¿°
æ ¹æ®é€‰æ‹©çš„ä¸»è¦ç±»åˆ«ï¼Œè‡ªåŠ¨è°ƒæ•´äºŒæ¬¡åˆ†ç±»çš„ä¸‹æ‹‰é€‰é¡¹å’Œæç¤ºï¼š

| ä¸»è¦ç±»åˆ« | äºŒæ¬¡åˆ†ç±»å†…å®¹ | æ•°æ®æ¥æº |
|---------|------------|---------|
| **ä¼šå‘˜è´¹** | å…³è”ä¼šå‘˜ | ä¼šå‘˜åˆ—è¡¨ï¼ˆæ´»è·ƒä¼šå‘˜ï¼‰ |
| **æ´»åŠ¨è´¢åŠ¡** | å…³è”æ´»åŠ¨ | æ´»åŠ¨åˆ—è¡¨ï¼ˆå·²å‘å¸ƒæ´»åŠ¨ï¼‰ |
| **æ—¥å¸¸è´¦æˆ·** | è´¦æˆ·ç”¨é€” | äº¤æ˜“ç”¨é€”ç®¡ç†åˆ—è¡¨ |

#### UIäº¤äº’æµç¨‹

```
ä¸»è¦ç±»åˆ«
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»è¦ç±»åˆ« *                           â”‚
â”‚ â–¼ é€‰æ‹©ä¸»è¦ç±»åˆ«                       â”‚
â”‚   - ä¼šå‘˜è´¹                           â”‚
â”‚   - æ´»åŠ¨è´¢åŠ¡                         â”‚
â”‚   - æ—¥å¸¸è´¦æˆ·                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è‡ªåŠ¨è°ƒæ•´äºŒæ¬¡åˆ†ç±»
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€ä¼šå‘˜è´¹ã€‘â†’ å…³è”ä¼šå‘˜                  â”‚
â”‚ â–¼ é€‰æ‹©ä¼šå‘˜                           â”‚
â”‚   - å¼ ä¸‰ - zhang@example.com        â”‚
â”‚   - æå›› - li@example.com           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€æ´»åŠ¨è´¢åŠ¡ã€‘â†’ å…³è”æ´»åŠ¨                â”‚
â”‚ â–¼ é€‰æ‹©æ´»åŠ¨                           â”‚
â”‚   - å¹´åº¦å¤§ä¼š (2024)                  â”‚
â”‚   - æ–°æ˜¥è”æ¬¢ (2025)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€æ—¥å¸¸è´¦æˆ·ã€‘â†’ è´¦æˆ·ç”¨é€”                â”‚
â”‚ â–¼ é€‰æ‹©è´¦æˆ·ç”¨é€”                       â”‚
â”‚   - åŠå…¬è´¹ç”¨                         â”‚
â”‚   - å·®æ—…è´¹                           â”‚
â”‚   - æ‹›å¾…è´¹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ–°å¢ç»„ä»¶

#### EditTransactionModal.tsx
ç‹¬ç«‹çš„ç¼–è¾‘äº¤æ˜“å¼¹çª—ç»„ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

```typescript
interface EditTransactionModalProps {
  visible: boolean;
  transaction: Transaction | null;  // null = åˆ›å»ºæ¨¡å¼
  bankAccounts: BankAccount[];
  form: FormInstance;
  onOk: () => Promise<void>;
  onCancel: () => void;
}
```

**æ ¸å¿ƒçŠ¶æ€**ï¼š
- `payerPayeeMode`: 'member' | 'manual' - ä»˜æ¬¾äººæ¨¡å¼
- `selectedCategory`: string - å½“å‰é€‰æ‹©çš„ä¸»è¦ç±»åˆ«
- `members`, `events`, `purposes`: æ•°æ®åˆ—è¡¨

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `loadData()`: åŠ è½½ä¼šå‘˜ã€æ´»åŠ¨ã€äº¤æ˜“ç”¨é€”æ•°æ®
- `handleCategoryChange()`: ç›‘å¬ç±»åˆ«å˜åŒ–ï¼Œé‡ç½®äºŒæ¬¡åˆ†ç±»
- `handleOk()`: æ ¹æ®æ¨¡å¼è®¾ç½®payerPayeeå’ŒpayerId

### æ•°æ®ç±»å‹æ›´æ–°

#### Transactionæ¥å£
```typescript
export interface Transaction {
  // ... å…¶ä»–å­—æ®µ
  payerPayee?: string;   // ä»˜æ¬¾äºº/æ”¶æ¬¾äººå§“å
  payerId?: string;      // ğŸ†• ä»˜æ¬¾äºº/æ”¶æ¬¾äººIDï¼ˆå¦‚æœæ˜¯ä¼šå‘˜ï¼‰
  category?: string;     // ä¸»è¦ç±»åˆ«
  txAccount?: string;    // äºŒæ¬¡åˆ†ç±»
}
```

#### TransactionFormDataæ¥å£
```typescript
export interface TransactionFormData {
  // ... å…¶ä»–å­—æ®µ
  payerPayee?: string;
  payerId?: string;      // ğŸ†• ä»˜æ¬¾äºº/æ”¶æ¬¾äººID
  category?: string;
  txAccount?: string;
}
```

### é¡µé¢é›†æˆ

#### TransactionManagementPage/index.tsx
```typescript
import EditTransactionModal from '../../components/EditTransactionModal';

// æ›¿æ¢åŸæœ‰çš„Modal
<EditTransactionModal
  visible={modalVisible}
  transaction={editingTransaction}
  bankAccounts={bankAccounts}
  form={form}
  onOk={handleSubmit}
  onCancel={() => {
    setModalVisible(false);
    form.resetFields();
    setEditingTransaction(null);
  }}
/>
```

---

## ğŸ“Š æ•°æ®æµç¨‹

### åˆ›å»ºäº¤æ˜“
```
1. ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºäº¤æ˜“"
   â†“
2. æ‰“å¼€EditTransactionModalï¼ˆtransaction = nullï¼‰
   â†“
3. è¡¨å•åˆå§‹åŒ–ä¸ºç©º
   â†“
4. ç”¨æˆ·é€‰æ‹©ç±»åˆ« â†’ åŠ¨æ€æ˜¾ç¤ºå¯¹åº”çš„äºŒæ¬¡åˆ†ç±»
   â†“
5. ç”¨æˆ·é€‰æ‹©ä»˜æ¬¾äººæ¨¡å¼ï¼ˆä¼šå‘˜/éä¼šå‘˜ï¼‰
   â†“
6. ç”¨æˆ·å¡«å†™å®Œæ•´ä¿¡æ¯
   â†“
7. ç‚¹å‡»"åˆ›å»º"
   â†“
8. handleOk() â†’ æ ¹æ®æ¨¡å¼è®¾ç½®payerPayeeå’ŒpayerId
   â†“
9. è°ƒç”¨createTransaction()
   â†“
10. ä¿å­˜åˆ°Firestore
```

### ç¼–è¾‘äº¤æ˜“
```
1. ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
   â†“
2. æ‰“å¼€EditTransactionModalï¼ˆtransaction = äº¤æ˜“å¯¹è±¡ï¼‰
   â†“
3. è¡¨å•è‡ªåŠ¨å¡«å……ç°æœ‰æ•°æ®
   â†“
4. æ ¹æ®transaction.payerIdåˆ¤æ–­æ¨¡å¼ï¼š
   - æœ‰payerId â†’ ä¼šå‘˜æ¨¡å¼
   - æ— payerId â†’ éä¼šå‘˜æ¨¡å¼
   â†“
5. æ ¹æ®categoryæ˜¾ç¤ºå¯¹åº”çš„äºŒæ¬¡åˆ†ç±»
   â†“
6. ç”¨æˆ·ä¿®æ”¹ä¿¡æ¯
   â†“
7. ç‚¹å‡»"ä¿å­˜"
   â†“
8. è°ƒç”¨updateTransaction()
   â†“
9. æ›´æ–°Firestore
```

---

## ğŸ¨ UI/UXæ”¹è¿›

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–

1. **æ™ºèƒ½æ¨¡å¼è¯†åˆ«**
   - ç¼–è¾‘æ—¶è‡ªåŠ¨è¯†åˆ«æ˜¯ä¼šå‘˜è¿˜æ˜¯éä¼šå‘˜
   - ä¿ç•™åŸæœ‰çš„ä»˜æ¬¾äººä¿¡æ¯

2. **æœç´¢åŠŸèƒ½**
   - ä¼šå‘˜é€‰æ‹©æ”¯æŒæ¨¡ç³Šæœç´¢ï¼ˆå§“åã€é‚®ç®±ï¼‰
   - æ´»åŠ¨é€‰æ‹©æ”¯æŒæ¨¡ç³Šæœç´¢
   - è´¦æˆ·ç”¨é€”é€‰æ‹©æ”¯æŒæ¨¡ç³Šæœç´¢

3. **æç¤ºä¿¡æ¯**
   - æ¯ä¸ªå­—æ®µéƒ½æœ‰tooltipè¯´æ˜
   - äºŒæ¬¡åˆ†ç±»æ ¹æ®ä¸»è¦ç±»åˆ«æ˜¾ç¤ºç›¸åº”çš„æç¤º

4. **åŠ è½½çŠ¶æ€**
   - æ•°æ®åŠ è½½æ—¶æ˜¾ç¤ºloadingçŠ¶æ€
   - ä¿å­˜æ—¶æŒ‰é’®æ˜¾ç¤ºç¡®è®¤çŠ¶æ€

5. **è¡¨å•éªŒè¯**
   - å¿…å¡«å­—æ®µæ ‡è®°*å·
   - å®æ—¶éªŒè¯è¾“å…¥
   - é”™è¯¯æç¤ºæ¸…æ™°

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åˆ›å»ºä¼šå‘˜è´¹äº¤æ˜“
```
1. ç‚¹å‡»"åˆ›å»ºäº¤æ˜“"
2. é€‰æ‹©é“¶è¡Œè´¦æˆ·: "ä¸»è´¦æˆ·"
3. é€‰æ‹©äº¤æ˜“æ—¥æœŸ: 2025-01-15
4. é€‰æ‹©äº¤æ˜“ç±»å‹: æ”¶å…¥
5. ä¸»è¦æè¿°: "2025å¹´ä¼šå‘˜è´¹"
6. é‡‘é¢: RM 480.00
7. ä»˜æ¬¾äººæ¨¡å¼: é€‰æ‹©"ä¼šå‘˜"
8. é€‰æ‹©ä¼šå‘˜: "å¼ ä¸‰ - zhang@example.com"
9. ä¸»è¦ç±»åˆ«: "ä¼šå‘˜è´¹"
10. å…³è”ä¼šå‘˜: "å¼ ä¸‰" (è‡ªåŠ¨å…³è”æˆ–æ‰‹åŠ¨é€‰æ‹©)
11. ä»˜æ¬¾æ–¹å¼: "é“¶è¡Œè½¬è´¦"
12. ç‚¹å‡»"åˆ›å»º"
```

**ä¿å­˜çš„æ•°æ®**:
```json
{
  "bankAccountId": "acc001",
  "transactionDate": "2025-01-15",
  "transactionType": "income",
  "mainDescription": "2025å¹´ä¼šå‘˜è´¹",
  "amount": 480,
  "payerPayee": "å¼ ä¸‰",
  "payerId": "member123",
  "category": "member-fees",
  "txAccount": "member123",
  "paymentMethod": "bank_transfer"
}
```

### ç¤ºä¾‹2: åˆ›å»ºä¾›åº”å•†ä»˜æ¬¾
```
1. ç‚¹å‡»"åˆ›å»ºäº¤æ˜“"
2. é€‰æ‹©é“¶è¡Œè´¦æˆ·: "ä¸»è´¦æˆ·"
3. é€‰æ‹©äº¤æ˜“æ—¥æœŸ: 2025-01-20
4. é€‰æ‹©äº¤æ˜“ç±»å‹: æ”¯å‡º
5. ä¸»è¦æè¿°: "åŠå…¬ç”¨å“é‡‡è´­"
6. é‡‘é¢: RM 350.00
7. ä»˜æ¬¾äººæ¨¡å¼: é€‰æ‹©"éä¼šå‘˜ï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰"
8. ä»˜æ¬¾äºº/æ”¶æ¬¾äºº: "ABCæ–‡å…·å…¬å¸"
9. ä¸»è¦ç±»åˆ«: "æ—¥å¸¸è´¦æˆ·"
10. è´¦æˆ·ç”¨é€”: "åŠå…¬è´¹ç”¨"
11. ä»˜æ¬¾æ–¹å¼: "é“¶è¡Œè½¬è´¦"
12. ç‚¹å‡»"åˆ›å»º"
```

**ä¿å­˜çš„æ•°æ®**:
```json
{
  "bankAccountId": "acc001",
  "transactionDate": "2025-01-20",
  "transactionType": "expense",
  "mainDescription": "åŠå…¬ç”¨å“é‡‡è´­",
  "amount": 350,
  "payerPayee": "ABCæ–‡å…·å…¬å¸",
  "payerId": null,
  "category": "general-accounts",
  "txAccount": "office-supplies",
  "paymentMethod": "bank_transfer"
}
```

---

## âœ… éªŒè¯æ¸…å•

- [x] åˆ›å»ºEditTransactionModalç»„ä»¶
- [x] æ·»åŠ payerIdå­—æ®µåˆ°Transactionæ¥å£
- [x] æ·»åŠ payerIdå­—æ®µåˆ°TransactionFormDataæ¥å£
- [x] å®ç°ä¼šå‘˜/éä¼šå‘˜æ¨¡å¼åˆ‡æ¢
- [x] å®ç°åŠ¨æ€äºŒæ¬¡åˆ†ç±»é€»è¾‘
- [x] é›†æˆåˆ°TransactionManagementPage
- [x] TypeScriptç¼–è¯‘é€šè¿‡
- [x] è¡¨å•éªŒè¯æ­£ç¡®
- [x] æ•°æ®ä¿å­˜æ­£ç¡®

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**
   - ä¼šå‘˜åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚æœä¼šå‘˜æ•°é‡>1000ï¼‰
   - æ´»åŠ¨åˆ—è¡¨åˆ†é¡µåŠ è½½

2. **åŠŸèƒ½å¢å¼º**
   - æœ€è¿‘ä½¿ç”¨çš„ä»˜æ¬¾äºº/æ”¶æ¬¾äººå¿«é€Ÿé€‰æ‹©
   - ä»˜æ¬¾äºº/æ”¶æ¬¾äººå†å²è®°å½•
   - æ‰¹é‡å¯¼å…¥æ—¶ä¹Ÿæ”¯æŒä¼šå‘˜é€‰æ‹©

3. **UIæ”¹è¿›**
   - ä¼šå‘˜å¡ç‰‡æ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼ˆå¤´åƒã€ç±»åˆ«ï¼‰
   - æ´»åŠ¨æ˜¾ç¤ºæ›´å¤šè¯¦æƒ…ï¼ˆæ—¥æœŸã€åœ°ç‚¹ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- `src/modules/finance/components/EditTransactionModal.tsx`
- `EDIT_TRANSACTION_MODAL_ENHANCEMENT.md`

### ä¿®æ”¹æ–‡ä»¶
- `src/modules/finance/pages/TransactionManagementPage/index.tsx`
- `src/modules/finance/types/index.ts`

---

**åŠŸèƒ½çŠ¶æ€**: âœ… **å·²å®Œæˆ**
**ç‰ˆæœ¬**: 1.0.0
**æ›´æ–°æ—¥æœŸ**: 2025-01-22
