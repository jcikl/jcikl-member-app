# æ ‘å½¢è§†å›¾è¡¨æ ¼å†…å®¹åˆ†æ

**åˆ†ææ—¶é—´**: 2025-01-13  
**åˆ†æèŒƒå›´**: äº¤æ˜“ç®¡ç†é¡µé¢æ ‘å½¢è§†å›¾è¡¨æ ¼

---

## ğŸ“‹ æ ‘å½¢è¡¨æ ¼ç»“æ„

### è¡¨æ ¼åˆ—å®šä¹‰

```typescript
const treeTableColumns: ColumnsType<TreeTableItem> = [
  {
    title: 'è´¦æˆ·/é¡¹ç›®åç§°',        // ç¬¬1åˆ—
    dataIndex: 'name',
    align: 'left',
    render: (text, record) => {
      // æ˜¾ç¤ºæ ‘å½¢ç»“æ„ï¼š
      // Level 0: ''          (æ— å‰ç¼€)
      // Level 1+: 'â”œâ”€â”€' æˆ– 'â””â”€â”€'
    }
  },
  {
    title: `${treeSelectedYear} (RM)`,  // ç¬¬2åˆ—ï¼ˆå½“å‰å¹´ä»½ï¼‰
    dataIndex: 'year2025',
    align: 'right',
    width: 120,
    render: (amount) => {
      // ç»¿è‰²æ˜¾ç¤ºæ­£æ•°
      // çº¢è‰²æ˜¾ç¤ºè´Ÿæ•°
    }
  },
  {
    title: `${treeSelectedYear - 1} (RM)`,  // ç¬¬3åˆ—ï¼ˆå‰ä¸€å¹´ï¼‰
    dataIndex: 'year2024',
    align: 'right',
    width: 120,
    render: (amount) => {
      // ç»¿è‰²æ˜¾ç¤ºæ­£æ•°
      // çº¢è‰²æ˜¾ç¤ºè´Ÿæ•°
    }
  }
]
```

**ç¤ºä¾‹æ˜¾ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è´¦æˆ·/é¡¹ç›®åç§°           â”‚ 2024 (RM)     â”‚ 2023 (RM)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ”¶å…¥                    â”‚              â”‚              â”‚
â”‚ â”œâ”€â”€ æ´»åŠ¨è´¢åŠ¡ (15)        â”‚              â”‚              â”‚
â”‚ â”‚ â”œâ”€â”€ Presidentï¼ˆä¼šé•¿ï¼‰  â”‚              â”‚              â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Hope for Nature 6â”‚              â”‚              â”‚
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### TreeTableItem æ¥å£

```typescript
interface TreeTableItem {
  key: string;                    // å”¯ä¸€æ ‡è¯†
  name: string;                   // æ˜¾ç¤ºåç§°
  level: number;                  // å±‚çº§ï¼š0=ä¸»ç±»åˆ«, 1=å­ç±»åˆ«, 2=å…·ä½“é¡¹ç›®
  isLastChild: boolean;           // æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå­é¡¹ï¼ˆå†³å®šæ˜¾ç¤º â”œâ”€â”€ è¿˜æ˜¯ â””â”€â”€ï¼‰
  count: number;                  // äº¤æ˜“æ•°é‡
  totalAmount: number;            // æ€»é‡‘é¢
  year2025: number;               // å½“å‰å¹´ä»½é‡‘é¢ï¼ˆå‡€æ”¶å…¥/å‡€æ”¯å‡ºï¼‰
  year2024: number;               // å‰ä¸€å¹´é‡‘é¢ï¼ˆå‡€æ”¶å…¥/å‡€æ”¯å‡ºï¼‰
  transactions: Transaction[];    // å…³è”çš„äº¤æ˜“æ•°æ®
  category?: string;              // ç±»åˆ«
  txAccount?: string;            // å­è´¦æˆ·
  boardMember?: string;           // è´Ÿè´£ç†äº‹
  eventName?: string;             // æ´»åŠ¨åç§°
}
```

---

## ğŸŒ³ æ ‘å½¢ç»“æ„å±‚æ¬¡

### Level 0: ä¸»ç±»åˆ«

```
æ”¶å…¥                (level: 0, category: null)
æ”¯å‡º                (level: 0, category: null)
```

### Level 1: å­ç±»åˆ«

```
æ”¶å…¥
â”œâ”€â”€ æ´»åŠ¨è´¢åŠ¡          (level: 1, category: 'event-finance')
â”œâ”€â”€ ä¼šå‘˜è´¹ç”¨          (level: 1, category: 'member-fees')
â””â”€â”€ æ—¥å¸¸è´¦æˆ·          (level: 1, category: 'general-accounts')
```

### Level 2: è´Ÿè´£ç†äº‹/å­è´¦æˆ·

**æ´»åŠ¨è´¢åŠ¡ (æŒ‰è´Ÿè´£ç†äº‹åˆ†ç»„)**:
```
â”œâ”€â”€ æ´»åŠ¨è´¢åŠ¡
â”‚   â”œâ”€â”€ Presidentï¼ˆä¼šé•¿ï¼‰    (level: 2, boardMember: 'president')
â”‚   â”œâ”€â”€ VP Community        (level: 2, boardMember: 'vp-community')
â”‚   â””â”€â”€ æœªè®¾ç½®è´Ÿè´£ç†äº‹       (level: 2, boardMember: 'unassigned')
```

**å…¶ä»–ç±»åˆ« (æŒ‰å­è´¦æˆ·åˆ†ç»„)**:
```
â”œâ”€â”€ ä¼šå‘˜è´¹ç”¨
â”‚   â”œâ”€â”€ 2024                (level: 2, txAccount: '2024')
â”‚   â””â”€â”€ 2023                (level: 2, txAccount: '2023')
```

### Level 3: å…·ä½“æ´»åŠ¨/é¡¹ç›®

**æ´»åŠ¨è´¢åŠ¡ (å…·ä½“æ´»åŠ¨)**:
```
â”œâ”€â”€ Presidentï¼ˆä¼šé•¿ï¼‰
â”‚   â”œâ”€â”€ Hope for Nature 6   (level: 3, eventName: 'Hope for Nature 6')
â”‚   â””â”€â”€ APBN 2025           (level: 3, eventName: 'APBN 2025')
```

**å…¶ä»–ç±»åˆ« (å…·ä½“é¡¹ç›®)**:
```
â”œâ”€â”€ æ—¥å¸¸è´¦æˆ·
â”‚   â””â”€â”€ ç§Ÿé‡‘æ”¶å…¥ (12)        (level: 2, txAccount: 'rental-income')
```

---

## ğŸ“‹ æ ‘å½¢æ•°æ®æ„å»ºé€»è¾‘

### 1. æŒ‰ç±»åˆ«åˆ†ç»„ (Line 1309-1319)

```typescript
// æŒ‰ç±»åˆ«åˆ†ç»„äº¤æ˜“
const groupedTransactions = transactions.reduce((acc, transaction) => {
  if (transaction.isSplit === true) return acc; // è·³è¿‡å·²æ‹†åˆ†çš„çˆ¶äº¤æ˜“
  
  const category = transaction.category || 'uncategorized';
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(transaction);
  return acc;
}, {} as Record<string, Transaction[]>);
```

**åˆ†ç»„ç»“æœ**:
```
{
  'event-finance': [Transaction, Transaction, ...],
  'member-fees': [Transaction, Transaction, ...],
  'general-accounts': [Transaction, Transaction, ...],
  'uncategorized': [Transaction, Transaction, ...]
}
```

---

### 2. ç±»åˆ«åç§°æ˜ å°„ (Line 1340-1345)

```typescript
const categoryNameMap: Record<string, string> = {
  'event-finance': 'æ´»åŠ¨è´¢åŠ¡',
  'member-fees': 'ä¼šå‘˜è´¹ç”¨',
  'general-accounts': 'æ—¥å¸¸è´¦æˆ·',
  'uncategorized': 'æœªåˆ†ç±»',
};
```

---

### 3. æ´»åŠ¨è´¢åŠ¡ç‰¹æ®Šå¤„ç† (Line 1379-1450)

**æŒ‰è´Ÿè´£ç†äº‹åˆ†ç»„ â†’ å†æŒ‰æ´»åŠ¨åˆ†ç»„**

```typescript
if (category === 'event-finance') {
  // Step 1: æŒ‰è´Ÿè´£ç†äº‹åˆ†ç»„
  const boardMemberGroups: Record<string, Transaction[]> = {};
  
  categoryTransactions.forEach(transaction => {
    const event = eventsMap.get(transaction.txAccount || '');
    const boardMemberKey = event?.boardMember || 'unassigned';
    // ...
  });
  
  // Step 2: ä¸ºæ¯ä¸ªè´Ÿè´£ç†äº‹åˆ›å»ºèŠ‚ç‚¹
  boardMemberKeys.forEach((boardMemberKey) => {
    tableData.push(createUnifiedTreeItem(
      `income-${category}-board-${boardMemberKey}`,
      `${boardMemberName} (${eventCount}ä¸ªæ´»åŠ¨) å‡€æ”¶å…¥: RM ${netTotal.toFixed(2)}`,
      // ...
    ));
    
    // Step 3: ä¸ºæ¯ä¸ªæ´»åŠ¨åˆ›å»ºå­èŠ‚ç‚¹
    eventNames.forEach((eventName) => {
      tableData.push(createUnifiedTreeItem(
        `income-${category}-board-${boardMemberKey}-event-${eventName}`,
        `${eventName} (${eventDate}) å‡€æ”¶å…¥: RM ${eventNetTotal.toFixed(2)}`,
        // ...
      ));
    });
  });
}
```

---

### 4. å…¶ä»–ç±»åˆ«å¤„ç† (Line 1452-1488)

**æŒ‰å­è´¦æˆ·åˆ†ç»„**

```typescript
else {
  // å…¶ä»–ç±»åˆ«ï¼šæŒ‰å­è´¦æˆ·åˆ†ç»„
  const subGroups = categoryTransactions.reduce((acc, transaction) => {
    const txAccount = transaction.txAccount || 'uncategorized';
    if (!acc[txAccount]) {
      acc[txAccount] = [];
    }
    acc[txAccount].push(transaction);
    return acc;
  }, {} as Record<string, Transaction[]>);
  
  // ä¸ºæ¯ä¸ªå­è´¦æˆ·åˆ›å»ºèŠ‚ç‚¹
  subGroupKeys.forEach((txAccount, subIndex) => {
    const items = subGroups[txAccount];
    const subTotal = items.reduce((sum, t) => sum + (t.amount || 0), 0);
    
    tableData.push(createUnifiedTreeItem(
      `income-${category}-${txAccount}`,
      `${displayName} (${items.length}) RM ${subTotal.toFixed(2)}`,
      // ...
    ));
  });
}
```

---

## ğŸ“Š æ˜¾ç¤ºç¤ºä¾‹

### å®Œæ•´æ ‘å½¢ç»“æ„ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è´¦æˆ·/é¡¹ç›®åç§°                            â”‚ 2024 (RM) â”‚ 2023 (RM) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ”¶å…¥                                    â”‚           â”‚           â”‚
â”‚ â”œâ”€â”€ æ´»åŠ¨è´¢åŠ¡ (15)                        â”‚ 50,000.00 â”‚ 45,000.00 â”‚
â”‚ â”‚ â”œâ”€â”€ Presidentï¼ˆä¼šé•¿ï¼‰(2ä¸ªæ´»åŠ¨)         â”‚ 25,000.00 â”‚ 20,000.00 â”‚
â”‚ â”‚ â”‚ â”œâ”€â”€ Hope for Nature 6 (å‡€æ”¶å…¥)     â”‚ 15,000.00 â”‚ 12,000.00 â”‚
â”‚ â”‚ â”‚ â””â”€â”€ APBN 2025 (å‡€æ”¶å…¥)              â”‚ 10,000.00 â”‚  8,000.00 â”‚
â”‚ â”‚ â””â”€â”€ VP Community (1ä¸ªæ´»åŠ¨)            â”‚ 25,000.00 â”‚ 25,000.00 â”‚
â”‚ â”‚   â””â”€â”€ Workshop 2024 (å‡€æ”¶å…¥)          â”‚ 25,000.00 â”‚ 25,000.00 â”‚
â”‚ â”œâ”€â”€ ä¼šå‘˜è´¹ç”¨ (30)                        â”‚ 12,000.00 â”‚ 10,000.00 â”‚
â”‚ â”‚ â”œâ”€â”€ 2024 (12)                         â”‚  7,000.00 â”‚           â”‚
â”‚ â”‚ â””â”€â”€ 2023 (18)                         â”‚           â”‚ 10,000.00 â”‚
â”‚ â””â”€â”€ æ—¥å¸¸è´¦æˆ· (8)                         â”‚  3,500.00 â”‚  3,200.00 â”‚
â”‚   â”œâ”€â”€ ç§Ÿé‡‘æ”¶å…¥ (4)                       â”‚  2,000.00 â”‚  2,000.00 â”‚
â”‚   â””â”€â”€ å…¶ä»–æ”¶å…¥ (4)                       â”‚  1,500.00 â”‚  1,200.00 â”‚
â”‚                                          â”‚           â”‚           â”‚
â”‚ æ”¯å‡º                                    â”‚           â”‚           â”‚
â”‚ â””â”€â”€ æ—¥å¸¸è´¦æˆ· (12)                        â”‚ -5,000.00 â”‚ -4,500.00 â”‚
â”‚   â”œâ”€â”€ ç§Ÿé‡‘æ”¯å‡º (6)                       â”‚ -3,000.00 â”‚ -3,000.00 â”‚
â”‚   â””â”€â”€ å…¶ä»–æ”¯å‡º (6)                       â”‚ -2,000.00 â”‚ -1,500.00 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å…³é”®ç‰¹æ€§

### 1. æ ‘å½¢æ˜¾ç¤º

- **Level 0**: æ— å‰ç¼€
- **Level 1+**: ä½¿ç”¨ `â”œâ”€â”€` æˆ– `â””â”€â”€` è¡¨ç¤ºå±‚çº§å…³ç³»
- **å±‚çº§ç¼©è¿›**: `paddingLeft: ${record.level * 20}px`

### 2. å¹´åº¦å¯¹æ¯”

- **ç¬¬2åˆ—**: å½“å‰å¹´ä»½é‡‘é¢
- **ç¬¬3åˆ—**: å‰ä¸€å¹´é‡‘é¢
- **åŠ¨æ€æ ‡é¢˜**: æ ¹æ® `treeSelectedYear` è‡ªåŠ¨æ›´æ–°

### 3. å‡€æ”¶å…¥è®¡ç®—

- **æ´»åŠ¨è´¢åŠ¡**: æ˜¾ç¤ºå‡€æ”¶å…¥ï¼ˆæ”¶å…¥ - æ”¯å‡ºï¼‰
- **å…¶ä»–ç±»åˆ«**: æ˜¾ç¤ºæ€»é¢

### 4. å¯ç‚¹å‡»å±•å¼€

- **Level 0**: ä¸å¯ç‚¹å‡»
- **Level 1+**: å¯ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†äº¤æ˜“

### 5. é¢œè‰²æ ‡è¯†

- **æ­£æ•°**: ç»¿è‰² (#52c41a)
- **è´Ÿæ•°**: çº¢è‰² (#ff4d4f)

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡ç¤ºä¾‹

### æ´»åŠ¨è´¢åŠ¡èŠ‚ç‚¹æ˜¾ç¤ºä¿¡æ¯

```
åç§°: Presidentï¼ˆä¼šé•¿ï¼‰(2ä¸ªæ´»åŠ¨) å‡€æ”¶å…¥: RM 25,000.00
å¹´ä»½2024: RM 25,000.00
å¹´ä»½2023: RM 20,000.00
```

### å…·ä½“æ´»åŠ¨èŠ‚ç‚¹æ˜¾ç¤ºä¿¡æ¯

```
åç§°: Hope for Nature 6 (15-01-2025) å‡€æ”¶å…¥: RM 15,000.00
å¹´ä»½2024: RM 15,000.00
å¹´ä»½2023: RM 12,000.00
```

---

## ğŸ” è¯¦ç»†å­—æ®µè¯´æ˜

### æ´»åŠ¨è´¢åŠ¡èŠ‚ç‚¹å­—æ®µ

```typescript
{
  key: 'income-event-finance-board-president-event-Hope for Nature 6',
  name: 'Hope for Nature 6 (15-01-2025) å‡€æ”¶å…¥: RM 15,000.00',
  level: 3,
  isLastChild: false,
  count: 5,                    // 5ç¬”äº¤æ˜“
  totalAmount: 20000,          // æ€»é‡‘é¢ RM 20,000
  year2025: 15000,             // 2024å¹´å‡€æ”¶å…¥ RM 15,000
  year2024: 12000,             // 2023å¹´å‡€æ”¶å…¥ RM 12,000
  transactions: [...],          // å…³è”çš„5ç¬”äº¤æ˜“
  category: 'event-finance',
  boardMember: 'president',
  eventName: 'Hope for Nature 6'
}
```

### ä¼šå‘˜è´¹ç”¨èŠ‚ç‚¹å­—æ®µ

```typescript
{
  key: 'income-member-fees-2024',
  name: '2024 (12)',
  level: 2,
  isLastChild: false,
  count: 12,                   // 12ç¬”äº¤æ˜“
  totalAmount: 7000,           // æ€»é‡‘é¢ RM 7,000
  year2025: 7000,             // 2024å¹´é‡‘é¢ RM 7,000
  year2024: 0,                // 2023å¹´é‡‘é¢ RM 0
  transactions: [...],         // å…³è”çš„12ç¬”äº¤æ˜“
  category: 'member-fees',
  txAccount: '2024'
}
```

---

## âœ… æ€»ç»“

### è¡¨æ ¼å†…å®¹

1. **ç¬¬1åˆ—**: æ ‘å½¢ç»“æ„æ˜¾ç¤ºï¼Œä½¿ç”¨å‰ç¼€å’Œç¼©è¿›è¡¨ç¤ºå±‚çº§
2. **ç¬¬2åˆ—**: å½“å‰å¹´ä»½çš„é‡‘é¢ï¼ˆæ ¹æ®é€‰æ‹©åŠ¨æ€å˜åŒ–ï¼‰
3. **ç¬¬3åˆ—**: ä¸Šä¸€å¹´çš„é‡‘é¢ï¼ˆç”¨äºå¯¹æ¯”ï¼‰

### æ ‘å½¢ç»“æ„

- **3-4 å±‚ç»“æ„**: ä¸»ç±»åˆ« â†’ å­ç±»åˆ« â†’ è´Ÿè´£ç†äº‹/å­è´¦æˆ· â†’ å…·ä½“æ´»åŠ¨/é¡¹ç›®
- **æ™ºèƒ½åˆ†ç»„**: æ´»åŠ¨è´¢åŠ¡æŒ‰è´Ÿè´£ç†äº‹åˆ†ç»„ï¼Œå…¶ä»–ç±»åˆ«æŒ‰å­è´¦æˆ·åˆ†ç»„
- **ç»Ÿè®¡ä¿¡æ¯**: æ˜¾ç¤ºäº¤æ˜“æ•°é‡ã€å‡€æ”¶å…¥ã€æ´»åŠ¨æ—¥æœŸç­‰

### äº¤äº’ç‰¹æ€§

- **å¯ç‚¹å‡»**: ç‚¹å‡»èŠ‚ç‚¹å¯æŸ¥çœ‹è¯¦ç»†äº¤æ˜“
- **é¢œè‰²åŒºåˆ†**: æ­£è´Ÿæ•°ç”¨ä¸åŒé¢œè‰²æ˜¾ç¤º
- **åŠ¨æ€æ›´æ–°**: æ ¹æ®æ—¥æœŸèŒƒå›´è‡ªåŠ¨è¿‡æ»¤å’Œç»Ÿè®¡

**åˆ†æå®Œæˆæ—¶é—´**: 2025-01-13  
**æ•°æ®ç»“æ„**: TreeTableItemï¼ˆ18ä¸ªå­—æ®µï¼‰  
**æ ‘å½¢å±‚çº§**: 3-4å±‚  
**å±•ç¤ºæ–¹å¼**: æ ‘å½¢è¡¨æ ¼ï¼Œå¹´åº¦å¯¹æ¯”

