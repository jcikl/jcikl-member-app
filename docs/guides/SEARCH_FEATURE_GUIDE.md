# 🔍 交易记录搜索功能指南

## 功能概述

交易记录页面现已支持**全局智能搜索**，可以同时搜索多个字段，包括描述、金额、类别、状态和交易类型。

---

## 🎯 支持的搜索字段

### 1. **描述搜索**
搜索以下字段：
- 主要描述 (`mainDescription`)
- 次要描述 (`subDescription`)
- 交易编号 (`transactionNumber`)
- 付款人/收款人 (`payerPayee`)

**示例**：
```
搜索: "会员费"     → 找到所有包含"会员费"的交易
搜索: "张三"       → 找到所有与张三相关的交易
搜索: "TXN-2024"   → 找到所有2024年的交易编号
```

---

### 2. **金额搜索** 🆕
直接输入金额数字进行搜索。

**示例**：
```
搜索: "300"        → 找到所有金额包含300的交易（如 300, 3000, 1300.50）
搜索: "1000"       → 找到所有金额包含1000的交易
搜索: "50.5"       → 找到金额为50.50的交易
```

**提示**：
- 支持部分匹配（如搜索"100"可找到100、1000、1100等）
- 支持小数点搜索

---

### 3. **类别搜索** 🆕
搜索交易类别字段。

**支持的类别**：
- `member-fees` - 会员费
- `event-income` - 活动收入
- `donations` - 捐赠
- `sponsorships` - 赞助
- `utilities` - 水电费
- `rent` - 租金
- `supplies` - 办公用品
- `salaries` - 工资
- `unallocated` - 未分配
- `other` - 其他

**示例**：
```
搜索: "member"     → 找到所有会员费交易
搜索: "会员"       → 同上
搜索: "event"      → 找到所有活动收入交易
搜索: "unallocated" → 找到所有未分配金额的子交易
```

---

### 4. **状态搜索** 🆕
搜索交易状态（支持中英文）。

**支持的状态**：

| 状态 | 英文关键词 | 中文关键词 |
|------|-----------|-----------|
| 已完成 | `completed`, `complete` | `已完成` |
| 待审核 | `pending`, `wait` | `待审核` |
| 已取消 | `cancelled`, `cancel` | `已取消` |
| 已拒绝 | `rejected`, `reject` | `已拒绝` |

**示例**：
```
搜索: "pending"    → 找到所有待审核的交易
搜索: "待审核"     → 同上
搜索: "completed"  → 找到所有已完成的交易
搜索: "已完成"     → 同上
```

---

### 5. **交易类型搜索** 🆕
搜索收入或支出类型。

**支持的关键词**：

| 类型 | 英文关键词 | 中文关键词 |
|------|-----------|-----------|
| 收入 | `income`, `in` | `收入` |
| 支出 | `expense`, `out`, `exp` | `支出` |

**示例**：
```
搜索: "income"     → 找到所有收入交易
搜索: "收入"       → 同上
搜索: "expense"    → 找到所有支出交易
搜索: "支出"       → 同上
```

---

## 🎨 使用方式

### 方式 1：全局搜索框
在页面顶部的搜索框中输入任意关键词：

```
┌────────────────────────────────────────────┐
│  🔍 搜索描述、金额、类别、状态...          │
└────────────────────────────────────────────┘
```

**特点**：
- ✅ 自动搜索所有字段
- ✅ 支持实时搜索（输入即搜索）
- ✅ 支持中英文混合搜索

---

### 方式 2：组合筛选
结合下拉筛选器进行精确筛选：

1. **类别筛选器** - 选择特定类别
2. **状态筛选器** - 选择特定状态
3. **搜索框** - 补充搜索其他字段

**示例场景**：
```
场景：找到所有待审核的会员费交易，金额为350
操作：
  1. 类别筛选 → 选择"会员费"
  2. 状态筛选 → 选择"待审核"
  3. 搜索框 → 输入"350"
```

---

## 💡 搜索技巧

### 1. 模糊搜索
搜索会自动进行模糊匹配，无需输入完整词汇。

```
✅ 搜索 "mem"  → 找到 "member-fees"
✅ 搜索 "会员" → 找到所有包含"会员"的交易
✅ 搜索 "30"   → 找到 300, 1300, 30.50 等
```

---

### 2. 多语言支持
中英文关键词都可以使用。

```
✅ "completed" = "已完成"
✅ "income" = "收入"
✅ "member" = "会员"
```

---

### 3. 大小写不敏感
搜索不区分大小写。

```
✅ "Member" = "member" = "MEMBER"
✅ "Income" = "income" = "INCOME"
```

---

### 4. 组合搜索
搜索框会同时匹配多个字段，返回任意匹配的结果。

**示例**：
```
搜索: "300"
结果包含：
  ✓ 描述中包含"300"的交易
  ✓ 金额为300的交易
  ✓ 金额为3000、1300等包含300的交易
```

---

## 📋 实际应用场景

### 场景 1：查找特定会员的会员费
```
步骤：
1. 搜索框输入：张三
2. 类别筛选：会员费
```

---

### 场景 2：查找所有待审核的交易
```
步骤：
1. 状态筛选：待审核
或
1. 搜索框输入：pending / 待审核
```

---

### 场景 3：查找特定金额的交易
```
步骤：
1. 搜索框输入：350
结果：所有金额包含350的交易（350.00, 3500, 1350 等）
```

---

### 场景 4：查找已拆分的交易
```
步骤：
1. 在交易列表查看带有 [已拆分 N] 标签的交易
或
1. 搜索框输入相关描述
```

---

### 场景 5：查找未分配金额的子交易
```
步骤：
1. 类别筛选：未分配
或
1. 搜索框输入：unallocated / 未分配
```

---

## 🔧 技术实现

### 搜索逻辑
```typescript
// 搜索优先级（OR逻辑）
matchDescription  // 描述、编号、付款人
  OR
matchAmount      // 金额
  OR
matchCategory    // 类别
  OR
matchStatus      // 状态
  OR
matchType        // 交易类型
```

### 状态映射
```typescript
const statusMap = {
  'completed': ['completed', '已完成', 'complete'],
  'pending': ['pending', '待审核', 'wait'],
  'cancelled': ['cancelled', '已取消', 'cancel'],
  'rejected': ['rejected', '已拒绝', 'reject'],
};
```

---

## ⚠️ 注意事项

1. **搜索范围**
   - 搜索仅在当前选中的银行账户标签页内进行
   - 切换标签页时，搜索条件保持不变

2. **虚拟交易**
   - 默认包含子交易（虚拟交易）
   - 子交易会在描述列显示 `[子项]` 标签

3. **性能**
   - 搜索在前端内存中进行（in-memory filtering）
   - 适用于中等规模数据（< 10,000 条）
   - 大规模数据建议使用筛选器缩小范围

4. **精确搜索**
   - 如需精确金额，使用筛选器的"高级筛选"功能（未来实现）
   - 当前金额搜索为包含匹配，非精确匹配

---

## 🚀 未来增强（计划中）

- [ ] 高级筛选面板（金额范围、日期范围）
- [ ] 保存常用搜索条件
- [ ] 搜索历史记录
- [ ] 导出搜索结果
- [ ] 搜索关键词高亮显示

---

## 📞 反馈

如有搜索功能相关的建议或问题，请联系系统管理员。

---

**最后更新**: 2025-01-16  
**版本**: 1.0  
**适用范围**: 交易管理页面

