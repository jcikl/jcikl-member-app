# æ•°æ®è¿ç§»æŒ‡å—ï¼šsubCategory â†’ txAccount

**è¿ç§»æ—¥æœŸ**: 2025-10-19  
**å½±å“èŒƒå›´**: Firestore æ•°æ®åº“å­—æ®µé‡å‘½å  
**é£é™©ç­‰çº§**: âš ï¸ ä¸­ç­‰ï¼ˆå¯å›æ»šï¼‰

---

## ğŸ“‹ æ¦‚è¿°

### è¿ç§»ç›®çš„
å°† Firestore ä¸­çš„ `subCategory` å­—æ®µé‡å‘½åä¸º `txAccount`ï¼Œä»¥æé«˜è¯­ä¹‰æ¸…æ™°åº¦ã€‚

### å­—æ®µè¯´æ˜
- **æ—§å­—æ®µå**: `subCategory` (äºŒæ¬¡åˆ†ç±»)
- **æ–°å­—æ®µå**: `txAccount` (äº¤æ˜“è´¦æˆ·/äº¤æ˜“ç”¨é€”)
- **å«ä¹‰**: ç”¨äºæ ‡è¯†äº¤æ˜“çš„å…·ä½“ç”¨é€”æˆ–è´¦æˆ·åˆ†ç±»

### å½±å“çš„é›†åˆ
1. `transactions` - äº¤æ˜“ä¸»è¡¨
2. `member_fees` - ä¼šå‘˜è´¹ç”¨è®°å½•
3. `event_financial_records` - æ´»åŠ¨è´¢åŠ¡è®°å½•
4. `general_financial_records` - æ—¥å¸¸è´¦æˆ·è´¢åŠ¡è®°å½•

---

## âš ï¸ è¿ç§»å‰å‡†å¤‡

### 1. å¤‡ä»½æ•°æ®åº“ï¼ˆå¼ºçƒˆæ¨èï¼‰

#### æ–¹æ³• 1: Firebase Console å¯¼å‡º
```bash
1. è®¿é—® Firebase Console
2. Firestore Database â†’ å¯¼å…¥/å¯¼å‡º
3. é€‰æ‹©å¯¼å‡ºä½ç½®ï¼ˆCloud Storage bucketï¼‰
4. ç‚¹å‡»"å¯¼å‡º"
5. ç­‰å¾…å®Œæˆå¹¶è®°å½•å¯¼å‡ºè·¯å¾„
```

#### æ–¹æ³• 2: Firebase CLI å¯¼å‡º
```bash
# å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“
firebase firestore:export gs://your-bucket/backups/2025-10-19-pre-migration

# å¯¼å‡ºç‰¹å®šé›†åˆ
firebase firestore:export gs://your-bucket/backups/2025-10-19-pre-migration \
  --collection-ids transactions,member_fees,event_financial_records,general_financial_records
```

### 2. éªŒè¯åº”ç”¨ä»£ç å·²æ›´æ–°
```bash
# ç¡®è®¤æ‰€æœ‰ä»£ç å·²ä½¿ç”¨ txAccount
git log --oneline -1
# åº”è¯¥çœ‹åˆ°: "refactor: Rename subCategory to txAccount..."

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check
# åº”è¯¥: âœ… é€šè¿‡

# è¿è¡Œ lint æ£€æŸ¥
npm run lint
# åº”è¯¥: âœ… é€šè¿‡
```

### 3. è®°å½•å½“å‰çŠ¶æ€
```bash
# è®°å½•å½“å‰ Firestore æ–‡æ¡£æ•°é‡
# å¯ä»¥åœ¨ Firebase Console æŸ¥çœ‹æˆ–è¿è¡Œ dry-run
npm run migrate:subcategory:dry
```

---

## ğŸš€ æ‰§è¡Œè¿ç§»

### æ­¥éª¤ 1: é¢„è§ˆæ¨¡å¼ï¼ˆDry Runï¼‰

**å¼ºçƒˆæ¨èå…ˆè¿è¡Œæ­¤å‘½ä»¤ï¼**

```bash
npm run migrate:subcategory:dry
```

**è¾“å‡ºç¤ºä¾‹**:
```
===============================================================================
ğŸ”„ DATA MIGRATION: subCategory â†’ txAccount
===============================================================================

Mode: ğŸ” DRY RUN
Remove old field: âŒ No
Collections: 4
Batch size: 500

ğŸš€ Starting migration...

============================================================
ğŸ“¦ Collection: transactions
============================================================
ğŸ“Š Total documents: 1,234
ğŸ“ Documents to migrate: 856

ğŸ“‹ Sample documents (first 3):
   1. ID: abc123
      subCategory: "new-member-fee" â†’ txAccount
   2. ID: def456
      subCategory: "HOPE FOR NATURE 6.0" â†’ txAccount
   3. ID: ghi789
      subCategory: "renewal-fee" â†’ txAccount

ğŸ” DRY RUN MODE - No changes will be made

============================================================
... (å…¶ä»–é›†åˆ)
============================================================

ğŸ“Š MIGRATION REPORT
===============================================================================
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Collection              â”‚ Total â”‚ To Migrateâ”‚ Migrated â”‚ Failed â”‚ Skipped â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ transactions            â”‚  1234 â”‚      856 â”‚        0 â”‚      0 â”‚     856 â”‚
â”‚ member_fees             â”‚   145 â”‚       95 â”‚        0 â”‚      0 â”‚      95 â”‚
â”‚ event_financial_records â”‚    12 â”‚       10 â”‚        0 â”‚      0 â”‚      10 â”‚
â”‚ general_financial_recordsâ”‚    8 â”‚        5 â”‚        0 â”‚      0 â”‚       5 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                   â”‚  1399 â”‚      966 â”‚        0 â”‚      0 â”‚     966 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ” DRY RUN: 966 documents would be migrated
===============================================================================
ğŸ” DRY RUN COMPLETED - No changes were made to the database

ğŸ’¡ To execute migration, run: npm run migrate:subcategory
===============================================================================
```

**æ£€æŸ¥æ¸…å•**:
- [ ] æ–‡æ¡£æ•°é‡ç¬¦åˆé¢„æœŸ
- [ ] Sample æ•°æ®çœ‹èµ·æ¥æ­£ç¡®
- [ ] æ²¡æœ‰æ„å¤–çš„é›†åˆè¢«åŒ…å«

---

### æ­¥éª¤ 2: æ‰§è¡Œè¿ç§»ï¼ˆä¿ç•™æ—§å­—æ®µï¼‰

**æ¨èæ–¹å¼ï¼šå…ˆè¿ç§»ä½†ä¿ç•™æ—§å­—æ®µ**

```bash
npm run migrate:subcategory
```

**äº¤äº’å¼ç¡®è®¤**:
```
âš ï¸  WARNING: This will modify production data!

ğŸŸ¡ Are you sure you want to proceed with migration (subCategory â†’ txAccount)? (yes/no): yes

ğŸš€ Starting migration...
```

**è¾“å‡ºç¤ºä¾‹**:
```
============================================================
ğŸ“¦ Collection: transactions
============================================================
ğŸ“Š Total documents: 1,234
ğŸ“ Documents to migrate: 856

ğŸš€ Starting migration...
ğŸ“¦ Processing batch 1/2
âœ… Batch committed: 500 documents
ğŸ“Š Progress: 58.4%
ğŸ“¦ Processing batch 2/2
âœ… Batch committed: 356 documents
ğŸ“Š Progress: 100.0%

âœ… Collection migration completed!

... (å…¶ä»–é›†åˆ)

ğŸ“Š MIGRATION REPORT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Collection              â”‚ Total â”‚ To Migrateâ”‚ Migrated â”‚ Failed â”‚ Skipped â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ transactions            â”‚  1234 â”‚      856 â”‚      856 â”‚      0 â”‚       0 â”‚
â”‚ member_fees             â”‚   145 â”‚       95 â”‚       95 â”‚      0 â”‚       0 â”‚
â”‚ event_financial_records â”‚    12 â”‚       10 â”‚       10 â”‚      0 â”‚       0 â”‚
â”‚ general_financial_recordsâ”‚    8 â”‚        5 â”‚        5 â”‚      0 â”‚       0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                   â”‚  1399 â”‚      966 â”‚      966 â”‚      0 â”‚       0 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… SUCCESS: 966 documents migrated successfully!

===============================================================================
âœ… MIGRATION COMPLETED

âœ… All 'subCategory' fields have been migrated to 'txAccount'

ğŸ’¡ Old 'subCategory' fields are still present for safety
   To remove them, run: npm run migrate:subcategory -- --remove-old
===============================================================================
```

**æ­¤æ—¶æ•°æ®çŠ¶æ€**:
```javascript
// Firestore æ–‡æ¡£åŒæ—¶åŒ…å«ä¸¤ä¸ªå­—æ®µ
{
  id: "abc123",
  category: "member-fees",
  subCategory: "new-member-fee",  // â† æ—§å­—æ®µï¼ˆä¿ç•™ï¼‰
  txAccount: "new-member-fee",    // â† æ–°å­—æ®µï¼ˆæ–°å¢ï¼‰
  amount: 480,
  ...
}
```

---

### æ­¥éª¤ 3: éªŒè¯è¿ç§»ç»“æœ

#### 3.1 æ£€æŸ¥åº”ç”¨åŠŸèƒ½
```
æµ‹è¯•æ¸…å•:
â–¡ ä¼šå‘˜è´¹ç”¨ç®¡ç†é¡µé¢
  â–¡ äº¤æ˜“åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
  â–¡ å·¦ä¾§ç­›é€‰å¡ç‰‡æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
  â–¡ ç‚¹å‡»å¡ç‰‡æ­£ç¡®ç­›é€‰
  
â–¡ äº¤æ˜“ç®¡ç†é¡µé¢
  â–¡ äºŒæ¬¡åˆ†ç±»åˆ—æ­£ç¡®æ˜¾ç¤º
  â–¡ ç­›é€‰åŠŸèƒ½æ­£å¸¸
  
â–¡ æ—¥å¸¸è´¦æˆ·é¡µé¢
  â–¡ åˆ†ç±»åŠŸèƒ½æ­£å¸¸
  
â–¡ æ´»åŠ¨è´¢åŠ¡é¡µé¢
  â–¡ æ´»åŠ¨åç§°ä½œä¸º txAccount æ­£ç¡®æ˜¾ç¤º
```

#### 3.2 æ£€æŸ¥ Firestore æ•°æ®
```bash
# åœ¨ Firebase Console æŸ¥çœ‹ä»»æ„äº¤æ˜“æ–‡æ¡£
# åº”è¯¥åŒæ—¶çœ‹åˆ° subCategory å’Œ txAccount å­—æ®µ
```

#### 3.3 ç›‘æ§ Console æ—¥å¿—
```javascript
// åº”è¯¥çœ‹åˆ°æ–°çš„æ—¥å¿—æ ¼å¼
ğŸ“Š [Component] TxAccount stats calculated: {...}
ğŸ”— [Component] TxAccount card clicked: 'new-member-fee'
```

---

### æ­¥éª¤ 4: ç§»é™¤æ—§å­—æ®µï¼ˆå¯é€‰ï¼Œè°¨æ…ï¼ï¼‰

**ä»…åœ¨ç¡®è®¤ä¸€åˆ‡æ­£å¸¸åæ‰§è¡Œ**

```bash
npm run migrate:subcategory -- --remove-old
```

**äº¤äº’å¼ç¡®è®¤**:
```
ğŸŸ¡ Are you sure you want to proceed with migration? (yes/no): yes

ğŸ”´ Are you ABSOLUTELY SURE you want to REMOVE the old field? 
   This cannot be undone! (yes/no): yes
```

**æ‰§è¡Œåæ•°æ®çŠ¶æ€**:
```javascript
// Firestore æ–‡æ¡£åªåŒ…å«æ–°å­—æ®µ
{
  id: "abc123",
  category: "member-fees",
  txAccount: "new-member-fee",  // â† åªä¿ç•™æ–°å­—æ®µ
  amount: 480,
  ...
}
```

âš ï¸ **è­¦å‘Š**: ç§»é™¤æ—§å­—æ®µåæ— æ³•è‡ªåŠ¨å›æ»šï¼Œåªèƒ½ä»å¤‡ä»½æ¢å¤ï¼

---

## âª å›æ»šè¿ç§»

### ä½•æ—¶éœ€è¦å›æ»š

- å‘ç°æ•°æ®è¿ç§»é”™è¯¯
- åº”ç”¨åŠŸèƒ½å¼‚å¸¸
- éœ€è¦ç´§æ€¥æ¢å¤æ—§ç‰ˆæœ¬

### å›æ»šæ­¥éª¤

#### æ–¹æ³• 1: ä½¿ç”¨å›æ»šè„šæœ¬ï¼ˆæ¨èï¼‰

**ä»…åœ¨æœªç§»é™¤æ—§å­—æ®µæ—¶å¯ç”¨**

```bash
npm run migrate:subcategory:rollback
```

**ç¡®è®¤æç¤º**:
```
ğŸ”´ Are you sure you want to ROLLBACK (txAccount â†’ subCategory)? (yes/no): yes
```

**è¾“å‡ºç¤ºä¾‹**:
```
âª ROLLBACK COMPLETED

âœ… Data has been rolled back to 'subCategory' field

ğŸ’¡ txAccount fields are still present
   To remove them, run with --remove-old flag
```

#### æ–¹æ³• 2: ä»å¤‡ä»½æ¢å¤

```bash
# ä» Cloud Storage æ¢å¤
firebase firestore:import gs://your-bucket/backups/2025-10-19-pre-migration
```

**æ³¨æ„**: è¿™ä¼šæ¢å¤æ•´ä¸ªæ•°æ®åº“åˆ°å¤‡ä»½æ—¶çš„çŠ¶æ€ï¼Œä¼šä¸¢å¤±è¿ç§»åçš„æ‰€æœ‰å…¶ä»–æ›´æ”¹ï¼

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1: Dry Run
```bash
npm run migrate:subcategory:dry
```
**é¢„æœŸ**: æ˜¾ç¤ºç»Ÿè®¡ä½†ä¸ä¿®æ”¹æ•°æ®

### æµ‹è¯• 2: è¿ç§»ï¼ˆä¿ç•™æ—§å­—æ®µï¼‰
```bash
npm run migrate:subcategory
```
**é¢„æœŸ**: 
- æ–°å¢ `txAccount` å­—æ®µ
- ä¿ç•™ `subCategory` å­—æ®µ
- åº”ç”¨æ­£å¸¸å·¥ä½œ

### æµ‹è¯• 3: å›æ»š
```bash
npm run migrate:subcategory:rollback
```
**é¢„æœŸ**: 
- æ¢å¤ `subCategory` ä¸ºä¸»å­—æ®µ
- ä¿ç•™ `txAccount` å­—æ®µ

### æµ‹è¯• 4: ç§»é™¤æ—§å­—æ®µ
```bash
npm run migrate:subcategory -- --remove-old
```
**é¢„æœŸ**: åªä¿ç•™ `txAccount` å­—æ®µ

---

## ğŸ“Š è¿ç§»ç»Ÿè®¡ç¤ºä¾‹

### æˆåŠŸè¿ç§»
```
âœ… SUCCESS: 966 documents migrated successfully!
   - transactions: 856
   - member_fees: 95
   - event_financial_records: 10
   - general_financial_records: 5
```

### éƒ¨åˆ†å¤±è´¥
```
âš ï¸  WARNING: 5 documents failed to migrate!
   - transactions: 3 failed
   - member_fees: 2 failed

ğŸ’¡ Check console for error details
ğŸ’¡ Re-run migration to retry failed documents
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è¿ç§»å¡ä½
**åŸå› **: ç½‘ç»œé—®é¢˜æˆ– Firestore é™æµ  
**è§£å†³**: 
```bash
# ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•
npm run migrate:subcategory
# è„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡å·²è¿ç§»çš„æ–‡æ¡£
```

### é—®é¢˜ 2: éƒ¨åˆ†æ–‡æ¡£å¤±è´¥
**åŸå› **: æƒé™ä¸è¶³æˆ–å­—æ®µå†²çª  
**è§£å†³**:
```bash
# æŸ¥çœ‹ Firebase Console çš„é”™è¯¯æ—¥å¿—
# æ‰‹åŠ¨ä¿®å¤å¤±è´¥çš„æ–‡æ¡£
# é‡æ–°è¿è¡Œè¿ç§»
```

### é—®é¢˜ 3: åº”ç”¨åŠŸèƒ½å¼‚å¸¸
**åŸå› **: ä»£ç æœªæ­£ç¡®æ›´æ–°æˆ–ç¼“å­˜é—®é¢˜  
**è§£å†³**:
```bash
# 1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# 2. é‡æ–°æ„å»ºåº”ç”¨
npm run build

# 3. å¦‚ä»æœ‰é—®é¢˜ï¼Œæ‰§è¡Œå›æ»š
npm run migrate:subcategory:rollback
```

### é—®é¢˜ 4: TypeScript ç±»å‹é”™è¯¯
**åŸå› **: æŸäº›æ–‡ä»¶æœªæ›´æ–°  
**è§£å†³**:
```bash
# æœç´¢æ˜¯å¦è¿˜æœ‰é—æ¼çš„ subCategory
grep -r "subCategory" src/

# æ‰‹åŠ¨æ›´æ–°é—æ¼çš„æ–‡ä»¶
# é‡æ–°è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check
```

---

## ğŸ“ è¿ç§»æ—¶é—´çº¿

### æ¨èè¿ç§»è®¡åˆ’

```
Day 1: å‡†å¤‡é˜¶æ®µ
â”œâ”€ 09:00 - å¤‡ä»½æ•°æ®åº“
â”œâ”€ 09:30 - è¿è¡Œ dry-run é¢„è§ˆ
â”œâ”€ 10:00 - éªŒè¯å¤‡ä»½æˆåŠŸ
â””â”€ 10:30 - å‡†å¤‡å›æ»šé¢„æ¡ˆ

Day 1: æ‰§è¡Œé˜¶æ®µï¼ˆä½å³°æœŸï¼‰
â”œâ”€ 14:00 - æ‰§è¡Œè¿ç§»ï¼ˆä¿ç•™æ—§å­—æ®µï¼‰
â”œâ”€ 14:30 - éªŒè¯åº”ç”¨åŠŸèƒ½
â”œâ”€ 15:00 - å…¨é¢æµ‹è¯•
â””â”€ 16:00 - ç¡®è®¤è¿ç§»æˆåŠŸ

Day 2-7: è§‚å¯ŸæœŸ
â”œâ”€ ç›‘æ§åº”ç”¨æ—¥å¿—
â”œâ”€ æ”¶é›†ç”¨æˆ·åé¦ˆ
â””â”€ éªŒè¯æ•°æ®å®Œæ•´æ€§

Day 8+: æ¸…ç†é˜¶æ®µï¼ˆå¯é€‰ï¼‰
â””â”€ ç§»é™¤æ—§å­—æ®µï¼ˆå¦‚ä¸€åˆ‡æ­£å¸¸ï¼‰
```

---

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

### è„šæœ¬å†…ç½®ä¿æŠ¤

1. **äº¤äº’å¼ç¡®è®¤** - æ‰§è¡Œå‰éœ€è¦ç”¨æˆ·ç¡®è®¤
2. **Dry Run æ¨¡å¼** - é»˜è®¤ä¸ä¿®æ”¹æ•°æ®
3. **æ‰¹é‡å¤„ç†** - åˆ†æ‰¹æ¬¡å¤„ç†ï¼Œé¿å…è¶…æ—¶
4. **é”™è¯¯å¤„ç†** - å•ä¸ªæ–‡æ¡£å¤±è´¥ä¸å½±å“æ•´ä½“
5. **è¿›åº¦è¿½è¸ª** - å®æ—¶æ˜¾ç¤ºè¿ç§»è¿›åº¦
6. **è¯¦ç»†æ—¥å¿—** - è®°å½•æ‰€æœ‰æ“ä½œ
7. **ä¿ç•™æ—§å­—æ®µ** - é»˜è®¤ä¸åˆ é™¤ `subCategory`
8. **å¯å›æ»š** - æä¾›å›æ»šåŠŸèƒ½

### å›æ»šä¿éšœ

```
è¿ç§»é˜¶æ®µ         å¯å›æ»šæ–¹å¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Dry Run      æ— éœ€å›æ»šï¼ˆæœªä¿®æ”¹æ•°æ®ï¼‰
2. è¿ç§»ï¼ˆä¿ç•™æ—§å­—æ®µï¼‰ âœ… ä½¿ç”¨å›æ»šè„šæœ¬
3. ç§»é™¤æ—§å­—æ®µ    âš ï¸ ä»…èƒ½ä»å¤‡ä»½æ¢å¤
```

---

## ğŸ’» å‘½ä»¤å‚è€ƒ

### å®Œæ•´å‘½ä»¤åˆ—è¡¨

```bash
# 1. é¢„è§ˆè¿ç§»ï¼ˆä¸ä¿®æ”¹æ•°æ®ï¼‰
npm run migrate:subcategory:dry

# 2. æ‰§è¡Œè¿ç§»ï¼ˆä¿ç•™æ—§å­—æ®µï¼‰
npm run migrate:subcategory

# 3. æ‰§è¡Œè¿ç§»å¹¶ç§»é™¤æ—§å­—æ®µï¼ˆå±é™©ï¼ï¼‰
npm run migrate:subcategory -- --remove-old

# 4. å›æ»šè¿ç§»ï¼ˆtxAccount â†’ subCategoryï¼‰
npm run migrate:subcategory:rollback

# 5. å›æ»šå¹¶ç§»é™¤ txAccount å­—æ®µï¼ˆå±é™©ï¼ï¼‰
npm run migrate:subcategory:rollback -- --remove-old
```

### å‘½ä»¤å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | æ¨è |
|------|------|------|
| `--dry-run` | é¢„è§ˆæ¨¡å¼ï¼Œä¸å†™å…¥æ•°æ® | âœ… æ€»æ˜¯å…ˆè¿è¡Œ |
| `--rollback` | å›æ»šæ¨¡å¼ï¼ŒtxAccount â†’ subCategory | âš ï¸ ä»…åœ¨éœ€è¦æ—¶ä½¿ç”¨ |
| `--remove-old` | åˆ é™¤æ—§å­—æ®µ | âŒ è°¨æ…ä½¿ç”¨ |

---

## ğŸ“ˆ æ€§èƒ½é¢„ä¼°

### è¿ç§»æ—¶é—´ä¼°ç®—

| æ–‡æ¡£æ•°é‡ | é¢„è®¡æ—¶é—´ | è¯´æ˜ |
|---------|---------|------|
| < 1,000 | 1-2 åˆ†é’Ÿ | å¿«é€Ÿå®Œæˆ |
| 1,000 - 10,000 | 5-10 åˆ†é’Ÿ | ä¸­ç­‰è§„æ¨¡ |
| 10,000 - 50,000 | 20-30 åˆ†é’Ÿ | å¤§è§„æ¨¡ |
| > 50,000 | 1+ å°æ—¶ | éœ€è¦åˆ†æ‰¹å¤„ç† |

**å½±å“å› ç´ **:
- Firestore å†™å…¥é€Ÿåº¦
- ç½‘ç»œå»¶è¿Ÿ
- æ‰¹å¤„ç†å¤§å° (å½“å‰: 500)

---

## âœ… è¿ç§»å®Œæˆæ£€æŸ¥æ¸…å•

### æ•°æ®å±‚
- [ ] æ‰€æœ‰é›†åˆè¿ç§»å®Œæˆ
- [ ] æ— å¤±è´¥æ–‡æ¡£
- [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡

### åº”ç”¨å±‚
- [ ] æ‰€æœ‰é¡µé¢åŠŸèƒ½æ­£å¸¸
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç»Ÿè®¡æ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] Console æ— é”™è¯¯æ—¥å¿—

### éƒ¨ç½²å±‚
- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] Netlify è‡ªåŠ¨éƒ¨ç½²å®Œæˆ
- [ ] ç”Ÿäº§ç¯å¢ƒæµ‹è¯•é€šè¿‡

---

## ğŸ” æƒé™è¦æ±‚

æ‰§è¡Œè¿ç§»éœ€è¦ï¼š
- âœ… Firestore è¯»å–æƒé™
- âœ… Firestore å†™å…¥æƒé™
- âœ… Node.js ç¯å¢ƒ
- âœ… Firebase é¡¹ç›®è®¿é—®æƒé™

---

## ğŸ“ æ”¯æŒ

### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹ Console é”™è¯¯æ—¥å¿—**
2. **è¿è¡Œ dry-run è¯Šæ–­**
3. **æ£€æŸ¥ Firebase Console çš„ Firestore è§„åˆ™**
4. **éªŒè¯ç½‘ç»œè¿æ¥**

### ç´§æ€¥å›æ»š

```bash
# ç«‹å³å›æ»š
npm run migrate:subcategory:rollback

# æˆ–ä»å¤‡ä»½æ¢å¤
firebase firestore:import gs://your-backup-path
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Firestore æ•°æ®è¿ç§»æœ€ä½³å®è·µ](https://firebase.google.com/docs/firestore/manage-data/move-data)
- [æ‰¹é‡æ“ä½œæŒ‡å—](https://firebase.google.com/docs/firestore/manage-data/transactions)

---

**è¿ç§»å®Œæˆæ—¶é—´**: å¾…æ‰§è¡Œ  
**è´Ÿè´£äºº**: ç³»ç»Ÿç®¡ç†å‘˜  
**çŠ¶æ€**: â³ å¾…æ‰§è¡Œ

---

**âš ï¸ è¯·åœ¨ä½å³°æœŸæ‰§è¡Œè¿ç§»ï¼Œå¹¶ç¡®ä¿å·²åšå¥½å®Œæ•´å¤‡ä»½ï¼**

