# 交易管理 - 标签页功能
## Transaction Management - Tabs Feature

---

## 🎯 功能概述

交易管理页面现在使用**标签页（Tabs）**来按银行账户组织交易，提供更清晰的视图和更好的用户体验。

---

## ✨ 新特性

### 1. 📑 **按账户分类的标签页**

每个银行账户都有自己的标签页：

```
┌──────────────────────────────────────────────────────────────┐
│  [所有账户 12] │ [JCI KL 主账户 8] │ [JCI KL 活动账户 4]     │
│                   余额: RM 14,557.44        余额: RM 81,189.82 │
└──────────────────────────────────────────────────────────────┘
```

**标签页显示信息**：
- 账户名称
- 默认账户标记（蓝色标签）
- 账户余额（仅针对具体账户）
- 交易数量徽章

### 2. 🎯 **智能交易数量统计**

每个标签页实时显示该账户的交易数量：
- **所有账户**: 蓝色徽章 - 显示总交易数
- **具体账户**: 绿色徽章 - 显示该账户的交易数

### 3. 🚀 **智能预选账户**

创建新交易时：
- 如果在**所有账户**标签页 → 预选**默认账户**
- 如果在**具体账户**标签页 → 预选**该账户**

例如：
```
用户在 "JCI KL 活动账户" 标签页
    ↓
点击 [新交易]
    ↓
表单自动预选 "JCI KL 活动账户" ✅
```

### 4. 🔄 **自动刷新计数**

以下操作会自动更新标签页的交易计数：
- ✅ 创建新交易
- ✅ 删除交易
- ✅ 批准交易
- ✅ 切换标签页

---

## 🎨 UI 设计

### 标签样式

#### **普通标签**
```
┌─────────────────┐
│ JCI KL 主账户   │
│ 余额: RM 14557  │
│        [8]       │  ← 绿色徽章
└─────────────────┘
```

#### **激活标签**
```
┌═════════════════┐
║ JCI KL 主账户   ║  ← 蓝色底边
║ 余额: RM 14557  ║
║        [8]       ║
└═════════════════┘
```

#### **默认账户标签**
```
┌─────────────────┐
│ JCI KL 主账户   │
│ [默认] ← 蓝色   │
│ 余额: RM 14557  │
└─────────────────┘
```

---

## 📋 使用流程

### 场景 1: 查看特定账户的交易

```
步骤:
1. 点击 "JCI KL 活动账户" 标签页
2. 自动筛选显示该账户的所有交易
3. 可以进一步使用搜索、类别、状态筛选
```

### 场景 2: 为特定账户创建交易

```
步骤:
1. 切换到目标账户的标签页（如 "JCI KL 主账户"）
2. 点击 [新交易] 按钮
3. 表单自动预选 "JCI KL 主账户" ✅
4. 填写其他信息并保存
5. 新交易自动显示在该标签页
6. 标签页徽章数量自动 +1
```

### 场景 3: 查看所有账户的交易

```
步骤:
1. 点击 "所有账户" 标签页
2. 显示所有银行账户的交易
3. 徽章显示总交易数
```

---

## 🔧 技术实现

### 核心组件

```typescript
// 标签页状态
const [activeTabKey, setActiveTabKey] = useState<string>('all');

// 交易数量统计
const [accountTransactionCounts, setAccountTransactionCounts] = 
  useState<Record<string, number>>({});

// 标签页切换
const handleTabChange = (key: string) => {
  setActiveTabKey(key);
  setCurrentPage(1); // 重置到第一页
};
```

### 数据加载

```typescript
// 当标签页切换时
useEffect(() => {
  loadTransactions();
}, [activeTabKey]);

// 加载时传递账户过滤
getTransactions({
  bankAccountId: activeTabKey !== 'all' ? activeTabKey : undefined,
  // ... 其他参数
});
```

---

## 📊 性能优化

### 交易数量缓存
- ✅ 仅在必要时更新（创建、删除、批准后）
- ✅ 使用独立的轻量查询（limit: 1，只获取 total）
- ✅ 不阻塞主数据加载

### 惰性加载
- ✅ 标签页切换时才加载对应数据
- ✅ 避免一次性加载所有账户的交易

---

## 🎯 用户体验改进

### 之前（使用下拉框）
```
❌ 需要打开下拉框选择账户
❌ 无法一眼看到各账户的交易数量
❌ 切换账户需要多次点击
❌ 不显示账户余额
```

### 现在（使用标签页）
```
✅ 一键切换账户
✅ 一目了然的交易数量（徽章）
✅ 实时显示账户余额
✅ 更好的视觉组织
✅ 智能预选账户
```

---

## 📱 响应式设计

### 桌面端
- 标签页横向排列
- 完整显示账户名称、余额、徽章
- 舒适的间距和字体大小

### 移动端（<768px）
- 标签页自动换行
- 缩小字体和内边距
- 保持关键信息可见

---

## 🔍 高级功能

### 1. 快速导航
```
键盘快捷键（未来功能）:
- Tab: 切换到下一个账户
- Shift+Tab: 切换到上一个账户
- Ctrl+1~9: 快速跳转到对应账户
```

### 2. 批量操作（未来功能）
在特定账户标签页中：
- 批量导出该账户的交易
- 批量更新交易状态
- 生成该账户的财务报表

---

## 📈 数据统计

### 标签页额外信息（未来增强）

可以在标签页中显示更多统计：
```
┌─────────────────────────────┐
│ JCI KL 主账户 [默认]        │
│ 余额: RM 14,557.44          │
│ 本月收入: +RM 5,000         │
│ 本月支出: -RM 2,000         │
│                [8条交易]     │
└─────────────────────────────┘
```

---

## 🛠️ 维护指南

### 添加新银行账户
- ✅ 自动出现新标签页
- ✅ 自动加载该账户的交易
- ✅ 自动显示计数和余额

### 删除银行账户
- ✅ 标签页自动移除
- ✅ 如果当前在该标签页，自动切换到"所有账户"
- ✅ 关联交易需要手动处理（使用账户修复工具）

---

## 🎨 样式定制

样式文件位置: `src/modules/finance/pages/TransactionManagementPage/styles.css`

可自定义：
- 标签页颜色
- 徽章样式
- 激活状态效果
- 响应式断点

---

## 📝 更新日志

- **2025-10-15**: 标签页功能上线
  - 替换下拉框为标签页
  - 添加交易数量统计
  - 添加账户余额显示
  - 实现智能账户预选
  - 优化样式和交互

---

## 🚀 立即体验

1. **刷新浏览器**
2. **访问**: `/finance/transactions`
3. **查看**: 顶部的银行账户标签页
4. **点击**: 任意标签页切换视图
5. **创建**: 新交易将自动关联当前标签页

享受全新的交易管理体验！🎉

