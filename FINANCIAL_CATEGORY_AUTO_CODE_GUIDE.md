# ğŸ“‹ è´¢åŠ¡ç±»åˆ«è‡ªåŠ¨ç¼–å·ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

**å®æ–½æ—¥æœŸ**: 2025-01-18  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶é€šè¿‡æµ‹è¯•

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

è´¢åŠ¡ç±»åˆ«ç®¡ç†ç³»ç»Ÿç°å·²æ”¯æŒ**è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç¼–å·**ï¼Œå¹¶å°†ç¼–å·ä½œä¸ºFirestoreæ–‡æ¡£IDï¼Œå®ç°æ›´é«˜æ•ˆçš„æ•°æ®ç®¡ç†ã€‚

---

## ğŸ“Š ç¼–å·æ ¼å¼

### æ”¶å…¥ç±»åˆ«
```
TXINC-0001
TXINC-0002
TXINC-0003
...
```

### æ”¯å‡ºç±»åˆ«
```
TXEXP-0001
TXEXP-0002
TXEXP-0003
...
```

**æ ¼å¼è¯´æ˜**:
- `TXINC` = Transaction Incomeï¼ˆäº¤æ˜“æ”¶å…¥ï¼‰
- `TXEXP` = Transaction Expenseï¼ˆäº¤æ˜“æ”¯å‡ºï¼‰
- `0001` = 4ä½åºå·ï¼Œè‡ªåŠ¨é€’å¢

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1ï¸âƒ£ åˆ›å»ºæ–°ç±»åˆ«

1. **è®¿é—®ç®¡ç†é¡µé¢**
   - URL: `/settings/financial-categories`
   - èœå•: `ç³»ç»Ÿè®¾ç½® â†’ è´¢åŠ¡ç±»åˆ«ç®¡ç†`

2. **ç‚¹å‡»æ·»åŠ æŒ‰é’®**
   - ç‚¹å‡»"æ·»åŠ æ”¶å…¥ç±»åˆ«"æˆ–"æ·»åŠ æ”¯å‡ºç±»åˆ«"

3. **è‡ªåŠ¨ç”Ÿæˆç¼–å·**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸‹ä¸€ä¸ªç¼–å·
   - ä¾‹å¦‚ï¼š`TXINC-0001`, `TXEXP-0001`
   - ç¼–å·å­—æ®µä¸º**ç¦ç”¨çŠ¶æ€**ï¼Œæ— æ³•æ‰‹åŠ¨ä¿®æ”¹

4. **å¡«å†™å…¶ä»–ä¿¡æ¯**
   - ç±»åˆ«åç§°ï¼šå¦‚"é—¨ç¥¨æ”¶å…¥"ã€"åœºåœ°è´¹"
   - å›¾æ ‡ï¼šé€‰æ‹©åˆé€‚çš„emoji
   - æè¿°ï¼šè¯´æ˜ä½¿ç”¨åœºæ™¯
   - æ’åºï¼šæ•°å­—è¶Šå°è¶Šé å‰
   - çŠ¶æ€ï¼šå¯ç”¨/ç¦ç”¨

5. **ä¿å­˜**
   - ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
   - ç³»ç»Ÿä¼šä½¿ç”¨ç¼–å·ä½œä¸ºæ–‡æ¡£ID

---

### 2ï¸âƒ£ ç¼–è¾‘ç°æœ‰ç±»åˆ«

1. **é€‰æ‹©ç±»åˆ«**
   - åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°è¦ç¼–è¾‘çš„ç±»åˆ«
   - ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®

2. **ä¿®æ”¹ä¿¡æ¯**
   - âš ï¸ **ç±»åˆ«ä»£ç ä¸å¯ä¿®æ”¹**ï¼ˆå®ƒæ˜¯æ–‡æ¡£IDï¼‰
   - å¯ä»¥ä¿®æ”¹ï¼šåç§°ã€å›¾æ ‡ã€æè¿°ã€æ’åºã€çŠ¶æ€

3. **ä¿å­˜æ›´æ”¹**
   - ç‚¹å‡»"ä¿å­˜"

---

### 3ï¸âƒ£ åˆ é™¤ç±»åˆ«

1. **ç¡®è®¤å½±å“**
   - åˆ é™¤å‰ï¼Œç³»ç»Ÿä¼šæç¤ºï¼š
   - "åˆ é™¤åï¼Œä½¿ç”¨æ­¤ç±»åˆ«çš„è´¢åŠ¡è®¡åˆ’éœ€è¦é‡æ–°åˆ†ç±»"

2. **ç¡®è®¤åˆ é™¤**
   - ç‚¹å‡»"ç¡®è®¤"æŒ‰é’®
   - ç±»åˆ«åŠå…¶æ–‡æ¡£IDå°†è¢«æ°¸ä¹…åˆ é™¤

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®ç»“æ„

#### Firestore æ–‡æ¡£è·¯å¾„
```
financialCategories/TXINC-0001
```

#### æ–‡æ¡£å†…å®¹
```json
{
  "value": "TXINC-0001",
  "label": "é—¨ç¥¨æ”¶å…¥",
  "type": "income",
  "icon": "ğŸŸï¸",
  "description": "æ´»åŠ¨é—¨ç¥¨é”€å”®æ”¶å…¥",
  "sortOrder": 1,
  "status": "active",
  "createdAt": "2025-01-18T...",
  "createdBy": "user-id",
  "updatedAt": "2025-01-18T...",
  "updatedBy": "user-id"
}
```

---

### æ ¸å¿ƒæœåŠ¡å‡½æ•°

#### 1. ç”Ÿæˆä¸‹ä¸€ä¸ªç¼–å·
```typescript
const nextCode = await generateNextCategoryCode('income');
// è¿”å›: "TXINC-0001"
```

**ç”Ÿæˆé€»è¾‘**:
1. æŸ¥è¯¢è¯¥ç±»å‹ä¸‹æ‰€æœ‰ç°æœ‰æ–‡æ¡£
2. æå–æ–‡æ¡£IDä¸­çš„åºå·éƒ¨åˆ†
3. æ‰¾åˆ°æœ€å¤§åºå·
4. åŠ 1å¹¶æ ¼å¼åŒ–ä¸º4ä½æ•°å­—
5. ç»„åˆå‰ç¼€å’Œåºå·

#### 2. åˆ›å»ºç±»åˆ«
```typescript
await createFinancialCategory({
  value: 'TXINC-0001',
  label: 'é—¨ç¥¨æ”¶å…¥',
  type: 'income',
  // ...å…¶ä»–å­—æ®µ
}, userId);
```

**ç‰¹ç‚¹**:
- ä½¿ç”¨ `value` ä½œä¸ºæ–‡æ¡£ID
- è‡ªåŠ¨æ£€æŸ¥é‡å¤ï¼ˆæ–‡æ¡£IDå¤©ç„¶å”¯ä¸€ï¼‰

#### 3. æ›´æ–°ç±»åˆ«
```typescript
await updateFinancialCategory('TXINC-0001', {
  label: 'æ–°åç§°',
  // value ä¸å¯ä¿®æ”¹
}, userId);
```

**é™åˆ¶**:
- ç¦æ­¢ä¿®æ”¹ `value` å­—æ®µ
- å…¶ä»–å­—æ®µå¯ä»¥è‡ªç”±ä¿®æ”¹

---

## ğŸ’¡ ä¼˜åŠ¿

### 1. ç®€æ´é«˜æ•ˆ
- âœ… æ–‡æ¡£IDå³ä¸ºç±»åˆ«ä»£ç 
- âœ… æ— éœ€ç»´æŠ¤é¢å¤–çš„ `id` å­—æ®µ
- âœ… ä»£ç ç»“æ„æ›´æ¸…æ™°

### 2. å¿«é€ŸæŸ¥è¯¢
```typescript
// ç›´æ¥é€šè¿‡ä»£ç è·å–ç±»åˆ«
const categoryRef = doc(db, 'financialCategories', 'TXINC-0001');
const categoryDoc = await getDoc(categoryRef);
```

### 3. å¤©ç„¶å”¯ä¸€
- âœ… Firestoreæ–‡æ¡£IDä¿è¯å…¨å±€å”¯ä¸€
- âœ… æ— éœ€é¢å¤–çš„å”¯ä¸€æ€§æ ¡éªŒ
- âœ… é¿å…é‡å¤ç¼–å·é—®é¢˜

### 4. è‡ªç„¶æ’åº
- âœ… Firestoreæ§åˆ¶å°æŒ‰å­—æ¯é¡ºåºæ˜¾ç¤º
- âœ… ä¾¿äºå¼€å‘å’Œè°ƒè¯•

### 5. å¯è¿½æº¯
- âœ… ç¼–å·åŒ…å«ç±»å‹ä¿¡æ¯ï¼ˆINC/EXPï¼‰
- âœ… åºå·åæ˜ åˆ›å»ºé¡ºåº
- âœ… ä¾¿äºå®¡è®¡å’Œè¿½è¸ª

---

## ğŸ¨ UI/UX ç‰¹ç‚¹

### è‡ªåŠ¨ç”Ÿæˆæç¤º
åˆ›å»ºæ—¶æ˜¾ç¤ºï¼š
```
âœ… ç³»ç»Ÿå·²è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç¼–å·
```

ç¼–è¾‘æ—¶æ˜¾ç¤ºï¼š
```
âš ï¸ ç±»åˆ«ä»£ç ä¸å¯ä¿®æ”¹ï¼ˆå®ƒæ˜¯æ–‡æ¡£IDï¼‰
```

### è§†è§‰æ•ˆæœ
- ç¼–å·å­—æ®µèƒŒæ™¯è‰²ï¼šæµ…è“è‰²ï¼ˆ`#e6f7ff`ï¼‰
- å­—ä½“ï¼šç­‰å®½å­—ä½“ï¼ˆ`monospace`ï¼‰
- é¢œè‰²ï¼šè“è‰²ï¼ˆ`#1890ff`ï¼‰
- å­—é‡ï¼šåŠ ç²—ï¼ˆ`600`ï¼‰

### è¡¨æ ¼æ˜¾ç¤º
- ç¼–å·æ˜¾ç¤ºä¸ºè“è‰²Tagæ ‡ç­¾
- ç­‰å®½å­—ä½“ï¼Œä¾¿äºå¯¹é½
- å°å­—å·ï¼ˆ`12px`ï¼‰

---

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåˆ›å»ºæ”¶å…¥ç±»åˆ«

**æ“ä½œæµç¨‹**:
1. ç‚¹å‡»"æ·»åŠ æ”¶å…¥ç±»åˆ«"
2. ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼š`TXINC-0001`
3. å¡«å†™ä¿¡æ¯ï¼š
   - ç±»åˆ«åç§°ï¼šé—¨ç¥¨æ”¶å…¥
   - å›¾æ ‡ï¼šğŸŸï¸
   - æè¿°ï¼šæ´»åŠ¨é—¨ç¥¨é”€å”®æ”¶å…¥
4. ç‚¹å‡»"ä¿å­˜"

**Firestoreç»“æœ**:
```
financialCategories/TXINC-0001 {
  value: "TXINC-0001",
  label: "é—¨ç¥¨æ”¶å…¥",
  type: "income",
  ...
}
```

---

### ç¤ºä¾‹2ï¼šåˆ›å»ºæ”¯å‡ºç±»åˆ«

**æ“ä½œæµç¨‹**:
1. ç‚¹å‡»"æ·»åŠ æ”¯å‡ºç±»åˆ«"
2. ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼š`TXEXP-0001`
3. å¡«å†™ä¿¡æ¯ï¼š
   - ç±»åˆ«åç§°ï¼šåœºåœ°è´¹
   - å›¾æ ‡ï¼šğŸ¢
   - æè¿°ï¼šä¼šåœºç§Ÿé‡‘å’Œåœºåœ°è´¹ç”¨
4. ç‚¹å‡»"ä¿å­˜"

**Firestoreç»“æœ**:
```
financialCategories/TXEXP-0001 {
  value: "TXEXP-0001",
  label: "åœºåœ°è´¹",
  type: "expense",
  ...
}
```

---

### ç¤ºä¾‹3ï¼šæ‰¹é‡åˆ›å»º

**æ”¶å…¥ç±»åˆ«**:
```
TXINC-0001 â†’ é—¨ç¥¨æ”¶å…¥ ğŸŸï¸
TXINC-0002 â†’ èµåŠ©æ”¶å…¥ ğŸ¤
TXINC-0003 â†’ ææ¬¾ ğŸ
```

**æ”¯å‡ºç±»åˆ«**:
```
TXEXP-0001 â†’ åœºåœ°è´¹ ğŸ¢
TXEXP-0002 â†’ é¤é¥®è´¹ ğŸ”
TXEXP-0003 â†’ å®£ä¼ è´¹ ğŸ“¢
```

---

## ğŸ” æƒé™æ§åˆ¶

### Firestore å®‰å…¨è§„åˆ™
```javascript
match /financialCategories/{categoryId} {
  allow read: if isAuthenticated();
  allow write: if isAdmin();
}
```

**è¯´æ˜**:
- æ‰€æœ‰ç™»å½•ç”¨æˆ·å¯ä»¥**è¯»å–**ç±»åˆ«
- åªæœ‰**ç®¡ç†å‘˜**å¯ä»¥**åˆ›å»º/ä¿®æ”¹/åˆ é™¤**ç±»åˆ«

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¼–å·ä¸å¯ä¿®æ”¹
- ç±»åˆ«ä»£ç ä¸€æ—¦ç”Ÿæˆï¼Œæ°¸ä¹…å›ºå®š
- å› ä¸ºå®ƒæ˜¯Firestoreæ–‡æ¡£ID
- å¦‚éœ€æ›´æ”¹ï¼Œåªèƒ½åˆ é™¤åé‡æ–°åˆ›å»º

### 2. åˆ é™¤å½±å“
- åˆ é™¤ç±»åˆ«å‰ï¼Œç¡®ä¿æ²¡æœ‰è´¢åŠ¡è®¡åˆ’ä½¿ç”¨å®ƒ
- ç³»ç»Ÿä¼šæç¤ºå½±å“èŒƒå›´
- åˆ é™¤åæ— æ³•æ¢å¤

### 3. åºå·è¿ç»­æ€§
- å¦‚æœåˆ é™¤ä¸­é—´çš„ç±»åˆ«ï¼Œåºå·ä¼šå‡ºç°é—´æ–­
- ä¾‹å¦‚ï¼š0001ã€0002ã€0004ï¼ˆ0003è¢«åˆ é™¤ï¼‰
- è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œä¸å½±å“ä½¿ç”¨

### 4. ç±»å‹é™åˆ¶
- åˆ›å»ºåï¼Œç±»å‹ï¼ˆæ”¶å…¥/æ”¯å‡ºï¼‰ä¸å¯ä¿®æ”¹
- å› ä¸ºç¼–å·å‰ç¼€å·²ç¡®å®šï¼ˆTXIINC/TXEXPï¼‰

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šç¼–å·ç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**: ç‚¹å‡»"æ·»åŠ "åï¼Œæ²¡æœ‰è‡ªåŠ¨ç”Ÿæˆç¼–å·

**å¯èƒ½åŸå› **:
- Firestoreè¿æ¥é—®é¢˜
- æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤å·²ç™»å½•
3. ç¡®è®¤æœ‰ç®¡ç†å‘˜æƒé™
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

---

### é—®é¢˜2ï¼šæç¤º"ç±»åˆ«ä»£ç å·²å­˜åœ¨"

**ç—‡çŠ¶**: ä¿å­˜æ—¶æŠ¥é”™"ç±»åˆ«ä»£ç  TXINC-0001 å·²å­˜åœ¨"

**å¯èƒ½åŸå› **:
- è¯¥ç¼–å·å·²è¢«ä½¿ç”¨
- å¯èƒ½æ˜¯ä¹‹å‰åˆ›å»ºè¿‡

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½
2. ç³»ç»Ÿä¼šè‡ªåŠ¨è·³åˆ°ä¸‹ä¸€ä¸ªç¼–å·
3. æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤åˆ›å»º

---

### é—®é¢˜3ï¼šæ— æ³•ä¿®æ”¹ç¼–å·

**ç—‡çŠ¶**: ç¼–å·å­—æ®µæ˜¾ç¤ºä¸ºç°è‰²ï¼Œæ— æ³•ç¼–è¾‘

**è¯´æ˜**: è¿™æ˜¯æ­£å¸¸è¡Œä¸º

**åŸå› **:
- ç¼–å·æ˜¯æ–‡æ¡£IDï¼Œä¸å¯ä¿®æ”¹
- è®¾è®¡ä¸Šçš„å®‰å…¨é™åˆ¶

**æ›¿ä»£æ–¹æ¡ˆ**:
- å¦‚æœç¡®å®éœ€è¦æ›´æ”¹ï¼Œåˆ é™¤åé‡æ–°åˆ›å»º

---

## ğŸ“Š æ•°æ®è¿ç§»

å¦‚æœæ‚¨ä¹‹å‰æœ‰ä½¿ç”¨éšæœºIDçš„ç±»åˆ«æ•°æ®ï¼Œéœ€è¦è¿ç§»åˆ°æ–°æ ¼å¼ï¼š

### è¿ç§»è„šæœ¬ï¼ˆç¤ºä¾‹ï¼‰
```typescript
// ä»…ä¾›å‚è€ƒï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
const migrateCategories = async () => {
  const oldCategories = await getAllOldCategories();
  
  for (const oldCat of oldCategories) {
    // ç”Ÿæˆæ–°ç¼–å·
    const newCode = await generateNextCategoryCode(oldCat.type);
    
    // åˆ›å»ºæ–°æ–‡æ¡£ï¼ˆä½¿ç”¨ç¼–å·ä½œä¸ºIDï¼‰
    await setDoc(
      doc(db, 'financialCategories', newCode),
      {
        ...oldCat,
        value: newCode,
      }
    );
    
    // åˆ é™¤æ—§æ–‡æ¡£
    await deleteDoc(doc(db, 'financialCategories', oldCat.id));
  }
};
```

---

## ğŸ‰ æ€»ç»“

è´¢åŠ¡ç±»åˆ«è‡ªåŠ¨ç¼–å·ç³»ç»Ÿæä¾›äº†ï¼š

1. âœ… **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹åŠ¨è¾“å…¥ç¼–å·
2. âœ… **å”¯ä¸€æ€§**: æ–‡æ¡£IDä¿è¯å…¨å±€å”¯ä¸€
3. âœ… **è§„èŒƒæ€§**: ç»Ÿä¸€çš„ç¼–å·æ ¼å¼
4. âœ… **å¯è¿½æº¯**: ç¼–å·åŒ…å«ç±»å‹å’Œåºå·ä¿¡æ¯
5. âœ… **é«˜æ•ˆæ€§**: ç›´æ¥ä½¿ç”¨ç¼–å·æŸ¥è¯¢æ•°æ®
6. âœ… **æ˜“ç”¨æ€§**: ç®€å•ç›´è§‚çš„ç”¨æˆ·ç•Œé¢

---

**ç‰ˆæœ¬**: 1.0  
**ä½œè€…**: AI Assistant  
**æœ€åæ›´æ–°**: 2025-01-18

